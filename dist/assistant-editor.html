<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>test - Assistant Configuration | VoicePartnerAI</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
            background: #0a0a0f;
            color: #ffffff;
            overflow-x: hidden;
        }

        /* Dark Theme Variables */
        :root {
            --bg-primary: #0a0a0f;
            --bg-secondary: #1a1a1f;
            --bg-tertiary: #2a2a30;
            --bg-card: #161618;
            --bg-input: #212126;
            --border-primary: #2a2a30;
            --border-secondary: #3a3a40;
            --border-active: #3b82f6;
            --text-primary: #ffffff;
            --text-secondary: #b4b4b8;
            --text-muted: #6b6b70;
            --accent-blue: #3b82f6;
            --accent-green: #10b981;
            --accent-purple: #8b5cf6;
            --accent-orange: #f59e0b;
            --accent-red: #ef4444;
            --accent-yellow: #eab308;
            --accent-cyan: #06b6d4;
        }

        /* Header */
        .header {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-primary);
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 0 2rem;
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .assistant-title {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .assistant-name {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 1.1rem;
        }

        .assistant-id {
            color: var(--text-muted);
            font-size: 0.875rem;
            font-family: monospace;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .btn {
            padding: 0.5rem 1rem;
            border: none;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.875rem;
            text-decoration: none;
        }

        .btn-primary {
            background: var(--accent-blue);
            color: white;
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: 1px solid var(--border-secondary);
        }

        .btn-success {
            background: var(--accent-green);
            color: white;
        }

        .btn-outline {
            background: transparent;
            color: var(--accent-blue);
            border: 1px solid var(--accent-blue);
        }

        .btn:hover {
            transform: translateY(-1px);
        }

        /* Main Layout */
        .main-container {
            display: flex;
            height: calc(100vh - 60px);
        }

        /* Tab Navigation */
        .tab-navigation {
            background: var(--bg-secondary);
            border-right: 1px solid var(--border-primary);
            width: 200px;
            padding: 1rem 0;
        }

        .tab-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 1.5rem;
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }

        .tab-item:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .tab-item.active {
            background: var(--bg-tertiary);
            color: var(--accent-blue);
            border-left-color: var(--accent-blue);
        }

        .tab-icon {
            width: 20px;
            text-align: center;
        }

        /* Content Area */
        .content-area {
            flex: 1;
            overflow-y: auto;
            background: var(--bg-primary);
        }

        .tab-content {
            display: none;
            padding: 2rem;
            max-width: 1200px;
        }

        .tab-content.active {
            display: block;
        }

        /* Cost/Latency Bar */
        .metrics-bar {
            background: var(--bg-secondary);
            border-bottom: 1px solid var(--border-primary);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .metric {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .metric-label {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        .metric-value {
            color: var(--text-primary);
            font-weight: 600;
        }

        .metric-bar {
            width: 300px;
            height: 4px;
            background: var(--bg-tertiary);
            border-radius: 2px;
            overflow: hidden;
        }

        .metric-progress {
            height: 100%;
            border-radius: 2px;
            background: linear-gradient(90deg, var(--accent-green), var(--accent-yellow), var(--accent-orange), var(--accent-red));
        }

        /* Provider Tags */
        .provider-tags {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 2rem;
        }

        .provider-tag {
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .provider-tag.vapi {
            background: var(--accent-blue);
            color: white;
        }

        .provider-tag.deepgram {
            background: var(--accent-purple);
            color: white;
        }

        .provider-tag.gpt {
            background: var(--accent-green);
            color: white;
        }

        .provider-tag.web {
            background: var(--accent-cyan);
            color: white;
        }

        /* Form Elements */
        .form-section {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }

        .form-section.collapsed {
            padding: 1rem 1.5rem;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            margin-bottom: 1rem;
        }

        .section-header h3 {
            color: var(--text-primary);
            font-weight: 600;
            font-size: 1.1rem;
        }

        .section-description {
            color: var(--text-muted);
            font-size: 0.875rem;
            margin-bottom: 1.5rem;
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin-bottom: 1.5rem;
        }

        .form-group {
            margin-bottom: 1.5rem;
        }

        .form-group.full-width {
            grid-column: span 2;
        }

        .form-label {
            display: block;
            color: var(--text-secondary);
            font-weight: 500;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
        }

        .form-input {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-input);
            border: 1px solid var(--border-secondary);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.875rem;
            transition: all 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: var(--border-active);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .form-select {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-input);
            border: 1px solid var(--border-secondary);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.875rem;
            cursor: pointer;
        }

        .form-textarea {
            width: 100%;
            min-height: 120px;
            padding: 0.75rem;
            background: var(--bg-input);
            border: 1px solid var(--border-secondary);
            border-radius: 6px;
            color: var(--text-primary);
            font-size: 0.875rem;
            resize: vertical;
            font-family: inherit;
        }

        .form-textarea.large {
            min-height: 200px;
        }

        /* Toggle Switch */
        .toggle-switch {
            position: relative;
            width: 44px;
            height: 24px;
            background: var(--bg-tertiary);
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .toggle-switch.active {
            background: var(--accent-blue);
        }

        .toggle-switch::after {
            content: '';
            position: absolute;
            top: 2px;
            left: 2px;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            transition: all 0.2s;
        }

        .toggle-switch.active::after {
            left: 22px;
        }

        /* Range Slider */
        .range-slider {
            width: 100%;
            -webkit-appearance: none;
            appearance: none;
            height: 4px;
            background: var(--bg-tertiary);
            border-radius: 2px;
            outline: none;
        }

        .range-slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 16px;
            height: 16px;
            background: var(--accent-blue);
            border-radius: 50%;
            cursor: pointer;
        }

        .range-values {
            display: flex;
            justify-content: space-between;
            color: var(--text-muted);
            font-size: 0.75rem;
            margin-top: 0.5rem;
        }

        .range-value {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        /* Collapsible Sections */
        .collapse-icon {
            transition: transform 0.2s;
            color: var(--text-muted);
        }

        .form-section.collapsed .collapse-icon {
            transform: rotate(-90deg);
        }

        .form-section.collapsed .section-content {
            display: none;
        }

        /* File Upload */
        .file-upload {
            border: 2px dashed var(--border-secondary);
            border-radius: 8px;
            padding: 2rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .file-upload:hover {
            border-color: var(--accent-blue);
            background: rgba(59, 130, 246, 0.05);
        }

        .file-upload-text {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        /* Generate Button */
        .generate-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--accent-green);
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }

        .textarea-container {
            position: relative;
        }

        .expand-btn {
            position: absolute;
            bottom: 0.5rem;
            right: 0.5rem;
            background: var(--bg-tertiary);
            color: var(--text-secondary);
            border: none;
            padding: 0.25rem;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.75rem;
        }

        /* Additional Configurations */
        .config-list {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .config-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 1rem;
            background: var(--bg-tertiary);
            border-radius: 8px;
        }

        .config-item-info h4 {
            color: var(--text-primary);
            font-weight: 600;
            margin-bottom: 0.25rem;
        }

        .config-item-info p {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }

        /* Modals */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            z-index: 2000;
            display: none;
            align-items: center;
            justify-content: center;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: 12px;
            padding: 2rem;
            max-width: 800px;
            width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }

        .modal-close {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 4px;
            transition: all 0.2s;
        }

        .modal-close:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .code-block {
            background: var(--bg-primary);
            border: 1px solid var(--border-secondary);
            border-radius: 8px;
            padding: 1rem;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            color: var(--text-secondary);
            overflow-x: auto;
            margin-bottom: 1rem;
        }

        .copy-btn {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: var(--accent-blue);
            color: white;
            border: none;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
        }

        .code-container {
            position: relative;
        }

        /* Save States */
        .btn.saving {
            opacity: 0.7;
            pointer-events: none;
        }

        .btn.saved {
            background: var(--accent-green) !important;
        }

        .btn.error {
            background: var(--accent-red) !important;
        }

        /* Test Panel */
        .test-panel {
            background: var(--bg-primary);
            border-radius: 8px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .test-controls {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .test-output {
            background: var(--bg-tertiary);
            border-radius: 6px;
            padding: 1rem;
            min-height: 200px;
            font-family: monospace;
            font-size: 0.875rem;
            color: var(--text-secondary);
            white-space: pre-wrap;
        }

        /* Chat Interface */
        .chat-interface {
            display: flex;
            flex-direction: column;
            height: 500px;
        }

        .chat-messages {
            flex: 1;
            padding: 1rem;
            background: var(--bg-primary);
            border-radius: 8px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }

        .message {
            margin-bottom: 1rem;
            padding: 0.75rem;
            border-radius: 8px;
            max-width: 80%;
        }

        .message.user {
            background: var(--accent-blue);
            color: white;
            margin-left: auto;
        }

        .message.assistant {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .chat-input {
            display: flex;
            gap: 0.75rem;
        }

        .chat-input input {
            flex: 1;
            padding: 0.75rem;
            background: var(--bg-input);
            border: 1px solid var(--border-secondary);
            border-radius: 6px;
            color: var(--text-primary);
        }

        /* Voice Call Interface */
        .voice-interface {
            text-align: center;
            padding: 2rem;
        }

        .call-button {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            border: none;
            background: var(--accent-green);
            color: white;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.2s;
            margin: 1rem;
        }

        .call-button:hover {
            transform: scale(1.1);
        }

        .call-button.calling {
            background: var(--accent-red);
            animation: pulse 1s infinite;
        }

        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }

        .call-status {
            color: var(--text-secondary);
            margin-top: 1rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .main-container {
                flex-direction: column;
            }
            
            .tab-navigation {
                width: 100%;
                height: auto;
                display: flex;
                overflow-x: auto;
            }
            
            .tab-item {
                flex-shrink: 0;
            }
            
            .form-row {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
            
            .form-group.full-width {
                grid-column: span 1;
            }
            
            .header-actions {
                gap: 0.5rem;
            }
            
            .btn {
                padding: 0.5rem;
                font-size: 0.75rem;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <div class="header">
        <div class="header-left">
            <button class="btn btn-secondary" onclick="goBack()" style="padding: 0.5rem; margin-right: 1rem;">
                <i class="fas fa-arrow-left"></i>
            </button>
            <div class="assistant-title">
                <div class="assistant-name">test</div>
                <div class="assistant-id">c3TNcGdE-b11G-4bbf-93u9...</div>
            </div>
        </div>
        
        <div class="header-actions">
            <button class="btn btn-secondary" onclick="showCode()">
                <i class="fas fa-code"></i>
                Code
            </button>
            <button class="btn btn-secondary" onclick="testAssistant()">
                <i class="fas fa-play"></i>
                Test
            </button>
            <button class="btn btn-secondary" onclick="openChat()">
                <i class="fas fa-comments"></i>
                Chat
            </button>
            <button class="btn btn-outline" onclick="talkToAssistant()">
                <i class="fas fa-phone"></i>
                Talk to Assistant
            </button>
            <button class="btn btn-success" id="saveButton" onclick="saveAssistant()">
                <span id="saveText">Save</span>
            </button>
        </div>
    </div>

    <!-- Metrics Bar -->
    <div class="metrics-bar">
        <div class="provider-tags">
            <span class="provider-tag voicepartnerai">voicepartnerai</span>
            <span class="provider-tag deepgram">deepgram</span>
            <span class="provider-tag gpt">gpt 4o</span>
            <span class="provider-tag voicepartnerai">voicepartnerai</span>
            <span class="provider-tag web">web</span>
        </div>
        
        <div style="display: flex; gap: 3rem;">
            <div class="metric">
                <span class="metric-label">Cost</span>
                <div class="metric-bar">
                    <div class="metric-progress" style="width: 15%;"></div>
                </div>
                <span class="metric-value">~$0.1 /min</span>
            </div>
            
            <div class="metric">
                <span class="metric-label">Latency</span>
                <div class="metric-bar">
                    <div class="metric-progress" style="width: 80%;"></div>
                </div>
                <span class="metric-value">~1050 ms</span>
            </div>
        </div>
        
        <div style="color: var(--text-secondary); font-size: 0.875rem;">
            Web <i class="fas fa-chevron-down"></i>
        </div>
    </div>

    <!-- Main Container -->
    <div class="main-container">
        <!-- Tab Navigation -->
        <div class="tab-navigation">
            <div class="tab-item active" onclick="switchTab('model')">
                <i class="tab-icon fas fa-brain"></i>
                <span>Model</span>
            </div>
            <div class="tab-item" onclick="switchTab('voice')">
                <i class="tab-icon fas fa-volume-up"></i>
                <span>Voice</span>
            </div>
            <div class="tab-item" onclick="switchTab('transcriber')">
                <i class="tab-icon fas fa-microphone"></i>
                <span>Transcriber</span>
            </div>
            <div class="tab-item" onclick="switchTab('tools')">
                <i class="tab-icon fas fa-wrench"></i>
                <span>Tools</span>
            </div>
            <div class="tab-item" onclick="switchTab('analysis')">
                <i class="tab-icon fas fa-chart-line"></i>
                <span>Analysis</span>
            </div>
            <div class="tab-item" onclick="switchTab('advanced')">
                <i class="tab-icon fas fa-cogs"></i>
                <span>Advanced</span>
            </div>
            <div class="tab-item" onclick="switchTab('widget')">
                <i class="tab-icon fas fa-puzzle-piece"></i>
                <span>Widget</span>
            </div>
        </div>

        <!-- Content Area -->
        <div class="content-area">
            <!-- Model Tab -->
            <div id="model-tab" class="tab-content active">
                <div class="form-section">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h3>Model</h3>
                        <i class="fas fa-chevron-down collapse-icon"></i>
                    </div>
                    <p class="section-description">Configure the behavior of the assistant.</p>
                    
                    <div class="section-content">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Provider</label>
                                <select class="form-select">
                                    <option selected>OpenAI</option>
                                    <option>Anthropic</option>
                                    <option>Google</option>
                                    <option>Meta</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Model</label>
                                <select class="form-select">
                                    <option selected>GPT 4o Cluster</option>
                                    <option>GPT 4o Mini</option>
                                    <option>GPT 4 Turbo</option>
                                    <option>Claude 3.5 Sonnet</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">First Message Mode</label>
                            <select class="form-select">
                                <option selected>Assistant speaks first</option>
                                <option>User speaks first</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">First Message</label>
                            <input type="text" class="form-input" value="Hello." placeholder="Enter first message...">
                        </div>
                        
                        <div class="form-group">
                            <div class="textarea-container">
                                <label class="form-label">System Prompt</label>
                                <button class="generate-btn">
                                    <i class="fas fa-magic"></i>
                                    Generate
                                </button>
                                <textarea class="form-textarea large" placeholder="Enter system prompt...">This is a blank template with minimal defaults, you can change the model, temperature, and messages.</textarea>
                                <button class="expand-btn">
                                    <i class="fas fa-expand-arrows-alt"></i>
                                </button>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Files</label>
                            <div class="file-upload">
                                <div class="file-upload-text">Select Files</div>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Max Tokens</label>
                                <input type="number" class="form-input" value="250" placeholder="250">
                            </div>
                            
                            <div class="form-group">
                                <div class="form-label">Temperature</div>
                                <input type="range" class="range-slider" min="0" max="2" step="0.1" value="0.5">
                                <div class="range-values">
                                    <span>0</span>
                                    <span class="range-value">0.5</span>
                                    <span>2</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Voice Tab -->
            <div id="voice-tab" class="tab-content">
                <div class="form-section">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h3>Voice Configuration</h3>
                        <i class="fas fa-chevron-down collapse-icon"></i>
                    </div>
                    <p class="section-description">Select a voice from the list or sync your voice library if it's missing. If errors persist, enable custom voice and add a voice ID.</p>
                    
                    <div class="section-content">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Provider</label>
                                <select class="form-select">
                                    <option selected>VoicePartnerAI</option>
                                    <option>ElevenLabs</option>
                                    <option>Azure</option>
                                    <option>PlayHT</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Voice</label>
                                <select class="form-select">
                                    <option selected>Elliot</option>
                                    <option>Sarah</option>
                                    <option>Emma</option>
                                    <option>James</option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="form-section collapsed">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h3>Additional Configuration</h3>
                        <i class="fas fa-chevron-down collapse-icon"></i>
                    </div>
                    <p class="section-description">Configure additional settings for the voice of your assistant.</p>
                </div>
            </div>

            <!-- Transcriber Tab -->
            <div id="transcriber-tab" class="tab-content">
                <div class="form-section">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h3>Transcriber</h3>
                        <i class="fas fa-chevron-down collapse-icon"></i>
                    </div>
                    <p class="section-description">This section allows you to configure the transcription settings for the assistant.</p>
                    
                    <div class="section-content">
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Provider</label>
                                <select class="form-select">
                                    <option selected>Deepgram</option>
                                    <option>AssemblyAI</option>
                                    <option>Google</option>
                                    <option>Azure</option>
                                </select>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Language</label>
                                <select class="form-select">
                                    <option selected>En</option>
                                    <option>De</option>
                                    <option>Es</option>
                                    <option>Fr</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Model</label>
                            <select class="form-select">
                                <option selected>Nova 2</option>
                                <option>Whisper</option>
                                <option>Enhanced</option>
                            </select>
                        </div>
                        
                        <div class="config-item">
                            <div class="config-item-info">
                                <h4>Background Denoising Enabled</h4>
                                <p>Filter background noise while the user is talking.</p>
                            </div>
                            <div class="toggle-switch active"></div>
                        </div>
                        
                        <div class="form-group">
                            <div class="form-label">Confidence Threshold</div>
                            <p class="section-description">Transcripts with a confidence score below this threshold will be filtered out.</p>
                            <input type="range" class="range-slider" min="0" max="1" step="0.1" value="0.4">
                            <div class="range-values">
                                <span>0</span>
                                <span class="range-value">0.4</span>
                                <span>1.0</span>
                            </div>
                        </div>
                        
                        <div class="config-item">
                            <div class="config-item-info">
                                <h4>Use Numerals</h4>
                                <p>Convert numbers from words to digits in transcription.</p>
                            </div>
                            <div class="toggle-switch active"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Tools Tab -->
            <div id="tools-tab" class="tab-content">
                <div class="form-section collapsed">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h3>Tools</h3>
                        <i class="fas fa-chevron-down collapse-icon"></i>
                    </div>
                    <p class="section-description">Tools enable voicebots to perform actions during calls. Add tools from the Tools Library to connect with Make.com or GHL workflows, or create custom tools with your backend.</p>
                </div>
                
                <div class="form-section collapsed">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h3>Predefined Functions</h3>
                        <i class="fas fa-chevron-down collapse-icon"></i>
                    </div>
                    <p class="section-description">We've pre-built functions for common use cases. You can enable them and configure them below.</p>
                </div>
                
                <div class="form-section collapsed">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h3>Custom Functions</h3>
                        <i class="fas fa-chevron-down collapse-icon"></i>
                    </div>
                    <p class="section-description">Define your custom functions here to enhance your assistant's capabilities. You can use your own code or tools like Pipedream or Make for the setup.</p>
                </div>
            </div>

            <!-- Analysis Tab -->
            <div id="analysis-tab" class="tab-content">
                <div class="form-section collapsed">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h3>Summary</h3>
                        <i class="fas fa-chevron-down collapse-icon"></i>
                    </div>
                    <p class="section-description">This is the prompt that's used to summarize the call. The output is stored in call.analysis.summary. You can also find the summary in the Call Logs Page.</p>
                </div>
                
                <div class="form-section collapsed">
                    <div class="section-header" onclick="toggleSection(this)">
                        <h3>Success Evaluation</h3>
                        <i class="fas fa-chevron-down collapse-icon"></i>
                    </div>
                    <p class="section-description">Evaluate if your call was successful. You can use Rubric standalone or in combination with Success Evaluation Prompt. If both are provided, they are concatenated into appropriate Instructions.</p>
                </div>
            </div>

            <!-- Advanced Tab -->
            <div id="advanced-tab" class="tab-content">
                <div class="form-section">
                    <div class="section-header">
                        <h3>Advanced Settings</h3>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Silence Timeout (seconds)</label>
                        <input type="number" class="form-input" value="30" placeholder="30">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Response Delay (ms)</label>
                        <input type="number" class="form-input" value="1000" placeholder="1000">
                    </div>
                    
                    <div class="config-item">
                        <div class="config-item-info">
                            <h4>Background Sound Enabled</h4>
                            <p>Play background sounds during conversations.</p>
                        </div>
                        <div class="toggle-switch"></div>
                    </div>
                    
                    <div class="config-item">
                        <div class="config-item-info">
                            <h4>Interruption Handling</h4>
                            <p>Allow users to interrupt the assistant.</p>
                        </div>
                        <div class="toggle-switch active"></div>
                    </div>
                </div>
            </div>

            <!-- Widget Tab -->
            <div id="widget-tab" class="tab-content">
                <div class="form-section">
                    <div class="section-header">
                        <h3>Widget Configuration</h3>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Widget Title</label>
                        <input type="text" class="form-input" value="Voice Assistant" placeholder="Enter widget title...">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Widget Description</label>
                        <textarea class="form-textarea" placeholder="Enter widget description...">Click to talk with our AI assistant</textarea>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Position</label>
                            <select class="form-select">
                                <option>Bottom Right</option>
                                <option>Bottom Left</option>
                                <option>Top Right</option>
                                <option>Top Left</option>
                            </select>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Theme</label>
                            <select class="form-select">
                                <option>Auto</option>
                                <option>Light</option>
                                <option>Dark</option>
                            </select>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Embed Code</label>
                        <textarea class="form-textarea" readonly>&lt;script src="https://cdn.vapi.ai/widget.js"&gt;&lt;/script&gt;
&lt;script&gt;
  VoicePartnerAI.init({
    apiKey: 'your-api-key',
    assistantId: 'c3TNcGdE-b11G-4bbf-93u9',
    title: 'Voice Assistant'
  });
&lt;/script&gt;</textarea>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Code Modal -->
    <div id="codeModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Assistant Integration Code</h2>
                <button class="modal-close" onclick="closeModal('codeModal')">&times;</button>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--text-primary); margin-bottom: 1rem;">JavaScript SDK</h3>
                <div class="code-container">
                    <div class="code-block">// Install the VoicePartnerAI SDK
npm install @voicepartnerai/web

// Import and initialize
import VoicePartnerAI from '@voicepartnerai/web';

const voicePartnerAI = new VoicePartnerAI('your-public-key');

// Start a call with your assistant
await vapi.start('assistant-id-here');</div>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
            </div>
            
            <div style="margin-bottom: 2rem;">
                <h3 style="color: var(--text-primary); margin-bottom: 1rem;">REST API</h3>
                <div class="code-container">
                    <div class="code-block">curl -X POST https://api.vapi.ai/call \
  -H "Authorization: Bearer your-api-key" \
  -H "Content-Type: application/json" \
  -d '{
    "assistantId": "assistant-id-here",
    "customer": {
      "number": "+1234567890"
    }
  }'</div>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
            </div>
            
            <div>
                <h3 style="color: var(--text-primary); margin-bottom: 1rem;">Widget Embed</h3>
                <div class="code-container">
                    <div class="code-block">&lt;script src="https://cdn.vapi.ai/widget.js"&gt;&lt;/script&gt;
&lt;script&gt;
  VoicePartnerAI.init({
    apiKey: 'your-public-key',
    assistantId: 'assistant-id-here',
    title: 'Talk to our AI Assistant',
    subtitle: 'Get instant help'
  });
&lt;/script&gt;</div>
                    <button class="copy-btn" onclick="copyCode(this)">Copy</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Test Modal -->
    <div id="testModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Test Assistant</h2>
                <button class="modal-close" onclick="closeModal('testModal')">&times;</button>
            </div>
            
            <div class="test-panel">
                <div class="test-controls">
                    <button class="btn btn-primary" onclick="runTest('voice')">
                        <i class="fas fa-microphone"></i>
                        Voice Test
                    </button>
                    <button class="btn btn-secondary" onclick="runTest('text')">
                        <i class="fas fa-keyboard"></i>
                        Text Test
                    </button>
                    <button class="btn btn-secondary" onclick="runTest('webhook')">
                        <i class="fas fa-link"></i>
                        Webhook Test
                    </button>
                </div>
                
                <div class="test-output" id="testOutput">Click a test button to start testing your assistant...</div>
            </div>
        </div>
    </div>

    <!-- Chat Modal -->
    <div id="chatModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Chat with Assistant</h2>
                <button class="modal-close" onclick="closeModal('chatModal')">&times;</button>
            </div>
            
            <div class="chat-interface">
                <div class="chat-messages" id="chatMessages">
                    <div class="message assistant">
                        <div>Hello! I'm your AI assistant. How can I help you today?</div>
                    </div>
                </div>
                
                <div class="chat-input">
                    <input type="text" id="chatInput" placeholder="Type your message..." onkeypress="handleChatKey(event)">
                    <button class="btn btn-primary" onclick="sendMessage()">
                        <i class="fas fa-paper-plane"></i>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Voice Call Modal -->
    <div id="voiceModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Talk to Assistant</h2>
                <button class="modal-close" onclick="closeModal('voiceModal')">&times;</button>
            </div>
            
            <div class="voice-interface">
                <div style="margin-bottom: 2rem;">
                    <h3 style="color: var(--text-primary);">Voice Call Test</h3>
                    <p style="color: var(--text-secondary);">Click the button below to start a voice call with your assistant.</p>
                </div>
                
                <button class="call-button" id="callButton" onclick="toggleCall()">
                    <i class="fas fa-phone" id="callIcon"></i>
                </button>
                
                <div class="call-status" id="callStatus">Ready to call</div>
                
                <div style="margin-top: 2rem;">
                    <div class="form-group">
                        <label class="form-label">Test Phone Number (optional)</label>
                        <input type="tel" class="form-input" placeholder="+1 234 567 8900" id="testNumber">
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        console.log('🤖 VAPI Assistant Editor loaded');
        
        // Tab switching
        function switchTab(tabName) {
            // Hide all tab contents
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            // Remove active class from all tabs
            document.querySelectorAll('.tab-item').forEach(tab => {
                tab.classList.remove('active');
            });
            
            // Show selected tab content
            document.getElementById(tabName + '-tab').classList.add('active');
            
            // Add active class to clicked tab
            event.target.closest('.tab-item').classList.add('active');
            
            console.log(`📝 Switched to ${tabName} tab`);
        }
        
        // Toggle section collapse
        function toggleSection(header) {
            const section = header.closest('.form-section');
            section.classList.toggle('collapsed');
            
            const icon = header.querySelector('.collapse-icon');
            if (section.classList.contains('collapsed')) {
                console.log('📁 Collapsed section');
            } else {
                console.log('📂 Expanded section');
            }
        }
        
        // Toggle switches
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('toggle-switch')) {
                e.target.classList.toggle('active');
                const isActive = e.target.classList.contains('active');
                console.log(`🔄 Toggle switch: ${isActive ? 'ON' : 'OFF'}`);
            }
        });
        
        // Range slider updates
        document.querySelectorAll('.range-slider').forEach(slider => {
            slider.addEventListener('input', function(e) {
                const value = e.target.value;
                const valueDisplay = e.target.parentElement.querySelector('.range-value');
                if (valueDisplay) {
                    valueDisplay.textContent = value;
                }
            });
        });
        
        // File upload
        document.querySelectorAll('.file-upload').forEach(upload => {
            upload.addEventListener('click', function() {
                const input = document.createElement('input');
                input.type = 'file';
                input.multiple = true;
                input.accept = '.txt,.pdf,.docx';
                input.onchange = function(e) {
                    const files = Array.from(e.target.files);
                    console.log('📄 Files selected:', files.map(f => f.name));
                    upload.querySelector('.file-upload-text').textContent = 
                        `${files.length} file(s) selected`;
                };
                input.click();
            });
        });
        
        // Header button functions
        function showCode() {
            console.log('📝 Showing integration code');
            document.getElementById('codeModal').classList.add('show');
        }
        
        function testAssistant() {
            console.log('🧪 Opening test interface');
            document.getElementById('testModal').classList.add('show');
        }
        
        function openChat() {
            console.log('💬 Opening chat interface');
            document.getElementById('chatModal').classList.add('show');
        }
        
        function talkToAssistant() {
            console.log('📞 Opening voice call interface');
            document.getElementById('voiceModal').classList.add('show');
        }
        
        // Modal management
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('show');
        }
        
        // Close modals on ESC key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                document.querySelectorAll('.modal').forEach(modal => {
                    modal.classList.remove('show');
                });
            }
        });
        
        // Close modals on background click
        document.querySelectorAll('.modal').forEach(modal => {
            modal.addEventListener('click', function(e) {
                if (e.target === modal) {
                    modal.classList.remove('show');
                }
            });
        });
        
        // Copy code functionality
        function copyCode(button) {
            const codeBlock = button.parentElement.querySelector('.code-block');
            const text = codeBlock.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.textContent;
                button.textContent = 'Copied!';
                button.style.background = 'var(--accent-green)';
                
                setTimeout(() => {
                    button.textContent = originalText;
                    button.style.background = 'var(--accent-blue)';
                }, 2000);
                
                console.log('📋 Code copied to clipboard');
            });
        }
        
        // Test functionality
        function runTest(testType) {
            const output = document.getElementById('testOutput');
            output.textContent = `Running ${testType} test...\n`;
            
            console.log(`🧪 Running ${testType} test`);
            
            // Simulate test execution
            setTimeout(() => {
                const results = {
                    voice: `Voice Test Results:
✅ Voice provider: Connected
✅ Audio quality: High (48kHz)
✅ Latency: 150ms
✅ Background noise: Filtered
⚠️  Recommendation: Consider reducing silence timeout

Test completed successfully!`,
                    text: `Text Test Results:
✅ Model response: GPT-4o Cluster
✅ Response time: 847ms
✅ Token usage: 245 tokens
✅ System prompt: Active
✅ First message: Configured

Sample conversation:
User: "Hello"
Assistant: "Hello! I'm your AI assistant. How can I help you today?"

Test completed successfully!`,
                    webhook: `Webhook Test Results:
✅ Endpoint: https://api.example.com/webhook
✅ Authentication: Bearer token valid
✅ Response time: 234ms
✅ Status: 200 OK
✅ Payload format: Valid JSON

Sample webhook payload:
{
  "event": "call.started",
  "assistantId": "c3TNcGdE-b11G-4bbf-93u9",
  "callId": "call_123456789"
}

Test completed successfully!`
                };
                
                output.textContent = results[testType];
            }, 2000);
        }
        
        // Chat functionality
        function sendMessage() {
            const input = document.getElementById('chatInput');
            const messages = document.getElementById('chatMessages');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Add user message
            const userMsg = document.createElement('div');
            userMsg.className = 'message user';
            userMsg.innerHTML = `<div>${message}</div>`;
            messages.appendChild(userMsg);
            
            input.value = '';
            messages.scrollTop = messages.scrollHeight;
            
            // Simulate assistant response
            setTimeout(() => {
                const responses = [
                    "I understand your request. How can I help you further?",
                    "That's a great question! Let me provide you with the information you need.",
                    "I'm here to assist you. What specific details would you like to know?",
                    "Thank you for reaching out. I'd be happy to help with that.",
                    "Based on your message, I can provide several options for you."
                ];
                
                const assistantMsg = document.createElement('div');
                assistantMsg.className = 'message assistant';
                assistantMsg.innerHTML = `<div>${responses[Math.floor(Math.random() * responses.length)]}</div>`;
                messages.appendChild(assistantMsg);
                
                messages.scrollTop = messages.scrollHeight;
            }, 1000);
        }
        
        function handleChatKey(event) {
            if (event.key === 'Enter') {
                sendMessage();
            }
        }
        
        // Voice call functionality
        let isCallActive = false;
        
        function toggleCall() {
            const callButton = document.getElementById('callButton');
            const callIcon = document.getElementById('callIcon');
            const callStatus = document.getElementById('callStatus');
            
            if (!isCallActive) {
                // Start call
                isCallActive = true;
                callButton.classList.add('calling');
                callIcon.className = 'fas fa-phone-slash';
                callStatus.textContent = 'Connecting...';
                
                console.log('📞 Starting voice call');
                
                setTimeout(() => {
                    callStatus.textContent = 'Connected - Speaking with assistant';
                }, 2000);
                
            } else {
                // End call
                isCallActive = false;
                callButton.classList.remove('calling');
                callIcon.className = 'fas fa-phone';
                callStatus.textContent = 'Call ended';
                
                console.log('📞 Ending voice call');
                
                setTimeout(() => {
                    callStatus.textContent = 'Ready to call';
                }, 2000);
            }
        }
        
        // Save assistant with professional validation
        function saveAssistant() {
            const saveButton = document.getElementById('saveButton');
            const saveText = document.getElementById('saveText');
            
            // Collect all configuration data
            const assistantData = {
                id: 'ast_' + Math.random().toString(36).substr(2, 9),
                name: document.querySelector('.assistant-name').textContent,
                firstMessage: document.querySelector('input[placeholder="Enter first message..."]')?.value || '',
                systemPrompt: document.querySelector('.form-textarea.large')?.value || '',
                model: document.querySelector('.form-select')?.value || 'gpt-4o-mini',
                voice: document.querySelector('select[name="voice"]')?.value || 'alloy',
                language: document.querySelector('select[name="language"]')?.value || 'en',
                provider: document.querySelector('select[name="provider"]')?.value || 'openai',
                createdAt: new Date().toISOString(),
                updatedAt: new Date().toISOString(),
                status: 'active',
                template: new URLSearchParams(window.location.search).get('template') || 'custom'
            };
            
            console.log('💾 Saving assistant configuration...', assistantData);
            
            // Show saving state
            saveButton.classList.add('saving');
            saveText.textContent = 'Saving...';
            
            // Simulate professional save process
            setTimeout(() => {
                // Validate required fields
                if (!assistantData.firstMessage || !assistantData.systemPrompt) {
                    // Error state
                    saveButton.classList.remove('saving');
                    saveButton.classList.add('error');
                    saveText.textContent = 'Error';
                    
                    setTimeout(() => {
                        saveButton.classList.remove('error');
                        saveText.textContent = 'Save';
                    }, 3000);
                    
                    console.error('❌ Save failed - missing required fields');
                    return;
                }
                
                // Save to localStorage
                try {
                    let savedAssistants = JSON.parse(localStorage.getItem('voicepartnerai_assistants') || '[]');
                    
                    // Check if updating existing assistant
                    const existingIndex = savedAssistants.findIndex(a => a.name === assistantData.name);
                    if (existingIndex !== -1) {
                        assistantData.id = savedAssistants[existingIndex].id;
                        assistantData.createdAt = savedAssistants[existingIndex].createdAt;
                        savedAssistants[existingIndex] = assistantData;
                    } else {
                        savedAssistants.push(assistantData);
                    }
                    
                    localStorage.setItem('voicepartnerai_assistants', JSON.stringify(savedAssistants));
                    
                    // Success state
                    saveButton.classList.remove('saving');
                    saveButton.classList.add('saved');
                    saveText.textContent = 'Published';
                    
                    // Update metrics
                    updateMetrics();
                    
                    console.log('✅ Assistant saved and published successfully', assistantData.id);
                    
                    // Clear unsaved changes flag
                    hasUnsavedChanges = false;
                    
                    // Auto-redirect back to dashboard after successful save
                    setTimeout(() => {
                        window.location.href = '/index.html';
                    }, 2000);
                    
                } catch (error) {
                    console.error('❌ Failed to save assistant:', error);
                    saveButton.classList.remove('saving');
                    saveButton.classList.add('error');
                    saveText.textContent = 'Error';
                    
                    setTimeout(() => {
                        saveButton.classList.remove('error');
                        saveText.textContent = 'Save';
                    }, 3000);
                }, 3000);
                
            }, 2000);
        }
        
        // Update cost/latency metrics
        function updateMetrics() {
            // Simulate metric calculation based on configuration
            const costBar = document.querySelector('.metric-progress[style*="width: 15%"]');
            const latencyBar = document.querySelector('.metric-progress[style*="width: 80%"]');
            
            if (costBar && latencyBar) {
                // Animate metric changes
                setTimeout(() => {
                    costBar.style.width = '20%';
                    latencyBar.style.width = '75%';
                }, 500);
            }
            
            console.log('📊 Updated performance metrics');
        }
        
        // Auto-save functionality
        let hasUnsavedChanges = false;
        
        function markUnsaved() {
            if (!hasUnsavedChanges) {
                hasUnsavedChanges = true;
                const saveText = document.getElementById('saveText');
                saveText.textContent = 'Save*';
                console.log('📝 Detected unsaved changes');
            }
        }
        
        // Track form changes
        document.addEventListener('input', function(e) {
            if (e.target.classList.contains('form-input') || 
                e.target.classList.contains('form-textarea') || 
                e.target.classList.contains('form-select')) {
                markUnsaved();
            }
        });
        
        // Warn on page leave
        window.addEventListener('beforeunload', function(e) {
            if (hasUnsavedChanges) {
                e.preventDefault();
                e.returnValue = 'You have unsaved changes. Are you sure you want to leave?';
            }
        });
        
        // Initialize URL parameters
        function initializeAssistantFromParams() {
            const urlParams = new URLSearchParams(window.location.search);
            const assistantName = urlParams.get('name');
            const template = urlParams.get('template');
            
            if (assistantName) {
                document.querySelector('.assistant-name').textContent = assistantName;
                document.title = `${assistantName} - Assistant Configuration | VoicePartnerAI`;
                console.log(`🤖 Initialized assistant: ${assistantName} (${template} template)`);
                
                // Apply template-specific configurations
                applyAssistantTemplate(template);
            }
        }
        
        // Apply different assistant templates
        function applyAssistantTemplate(template) {
            const firstMessageInput = document.querySelector('input[placeholder="Enter first message..."]');
            const systemPromptTextarea = document.querySelector('.form-textarea.large');
            
            const templates = {
                'customer-support': {
                    firstMessage: 'Hello! I\'m here to help with your support request. How can I assist you today?',
                    systemPrompt: 'You are a helpful customer support assistant. Be professional, empathetic, and solution-focused. Always try to resolve issues or escalate to human agents when necessary.'
                },
                'appointment-setter': {
                    firstMessage: 'Hi! I\'d be happy to help you schedule an appointment. What type of appointment are you looking for?',
                    systemPrompt: 'You are an appointment scheduling assistant. Help users find available time slots, collect necessary information, and confirm appointments. Be efficient and friendly.'
                },
                'lead-qualifier': {
                    firstMessage: 'Thank you for your interest! I\'d like to learn more about your needs to connect you with the right solution.',
                    systemPrompt: 'You are a lead qualification assistant. Ask relevant questions to understand the prospect\'s needs, budget, timeline, and decision-making process. Be consultative and helpful.'
                },
                'sales-agent': {
                    firstMessage: 'Hello! I\'m excited to help you learn more about our products and find the perfect solution for you.',
                    systemPrompt: 'You are a sales assistant. Present product benefits, handle objections, and guide prospects through the sales process. Be persuasive but not pushy.'
                }
            };
            
            if (templates[template]) {
                if (firstMessageInput) {
                    firstMessageInput.value = templates[template].firstMessage;
                }
                if (systemPromptTextarea) {
                    systemPromptTextarea.value = templates[template].systemPrompt;
                }
            }
        }
        
        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializeAssistantFromParams();
        });
        
        // Back navigation
        function goBack() {
            if (confirm('Are you sure you want to leave? Unsaved changes will be lost.')) {
                window.location.href = '/index.html';
            }
        }
        
        // Auto-expand textarea
        document.querySelectorAll('.form-textarea').forEach(textarea => {
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = this.scrollHeight + 'px';
            });
        });
    </script>
</body>
</html>