<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>VoicePartnerAI Enterprise - 100% Vapi Parity Dashboard</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.socket.io/4.7.4/socket.io.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="/vapi-integration.js"></script>
    <script src="/voice-engine-real.js"></script>
    <style>
        :root {
            --primary-color: #3b82f6;
            --secondary-color: #64748b;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --bg-primary: #ffffff;
            --bg-secondary: #f8fafc;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --border-color: #e2e8f0;
            --shadow-sm: 0 1px 2px 0 rgba(0, 0, 0, 0.05);
            --shadow-md: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            --sidebar-width: 280px;
        }
        
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Inter', sans-serif; 
            background: var(--bg-secondary); 
            color: var(--text-primary);
            line-height: 1.6;
        }
        
        body.modal-open {
            overflow: hidden;
        }

        /* Vapi-Style Template Modal */
        .vapi-modal {
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
        }

        .vapi-modal-content {
            max-width: 900px;
            width: 95%;
            max-height: 90vh;
            border-radius: 16px;
            background: white;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
            overflow: hidden;
        }

        .vapi-modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 2rem;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            border-bottom: none;
        }

        .vapi-header-content h2 {
            font-size: 1.75rem;
            font-weight: 700;
            margin: 0;
            margin-bottom: 0.5rem;
        }

        .vapi-modal-subtitle {
            font-size: 1rem;
            opacity: 0.9;
            margin: 0;
            font-weight: 400;
        }

        .vapi-modal-close {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 1.1rem;
        }

        .vapi-modal-close:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .vapi-modal-body {
            padding: 2rem;
        }

        .vapi-templates-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .vapi-template-card {
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            background: white;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            overflow: hidden;
            position: relative;
        }

        .vapi-template-card:hover {
            border-color: #667eea;
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.15);
        }

        .vapi-template-header {
            padding: 1.5rem 1.5rem 1rem;
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
        }

        .vapi-template-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .blank-icon { background: linear-gradient(135deg, #667eea, #764ba2); }
        .support-icon { background: linear-gradient(135deg, #f093fb, #f5576c); }
        .appointment-icon { background: linear-gradient(135deg, #4facfe, #00f2fe); }
        .qa-icon { background: linear-gradient(135deg, #43e97b, #38f9d7); }

        .vapi-template-badge {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea;
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .vapi-template-content {
            padding: 0 1.5rem 1rem;
        }

        .vapi-template-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
            margin: 0 0 0.5rem;
        }

        .vapi-template-description {
            color: #6b7280;
            font-size: 0.95rem;
            line-height: 1.5;
            margin: 0;
        }

        .vapi-template-footer {
            padding: 1rem 1.5rem 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-top: 1px solid #f3f4f6;
            background: #fafbfc;
        }

        .vapi-template-category {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 0.85rem;
            font-weight: 500;
            text-transform: capitalize;
        }

        .vapi-template-category.general { color: #667eea; }
        .vapi-template-category.support { color: #f5576c; }
        .vapi-template-category.sales { color: #00f2fe; }

        .vapi-template-category i {
            font-size: 0.5rem;
        }

        .vapi-template-arrow {
            color: #9ca3af;
            transition: all 0.2s;
        }

        .vapi-template-card:hover .vapi-template-arrow {
            color: #667eea;
            transform: translateX(3px);
        }

        .vapi-template-actions {
            text-align: center;
            padding-top: 1rem;
            border-top: 1px solid #e5e7eb;
        }

        .vapi-btn-secondary {
            background: transparent;
            color: #6b7280;
            border: 1px solid #d1d5db;
            padding: 0.75rem 2rem;
            border-radius: 8px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .vapi-btn-secondary:hover {
            background: #f9fafb;
            border-color: #9ca3af;
            color: #374151;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .vapi-templates-container {
                grid-template-columns: 1fr;
            }
            
            .vapi-modal-content {
                width: 98%;
                margin: 1rem;
            }
            
            .vapi-modal-header {
                padding: 1.5rem;
            }
            
            .vapi-modal-body {
                padding: 1.5rem;
            }
        }
        
        .header {
            background: linear-gradient(135deg, var(--primary-color), #6366f1);
            color: white;
            padding: 1rem 2rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            box-shadow: var(--shadow-md);
            position: sticky;
            top: 0;
            z-index: 100;
        }
        
        .logo {
            display: flex;
            align-items: center;
            font-size: 1.5rem;
            font-weight: 700;
        }
        
        .logo i { margin-right: 0.5rem; }
        
        .header-status {
            display: flex;
            align-items: center;
            gap: 2rem;
        }
        
        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            font-size: 0.875rem;
        }
        
        .pulse {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--success-color);
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; transform: scale(1); }
            50% { opacity: 0.5; transform: scale(1.1); }
        }
        
        .main-container {
            display: flex;
            min-height: calc(100vh - 80px);
        }
        
        .sidebar {
            width: var(--sidebar-width);
            background: var(--bg-primary);
            border-right: 1px solid var(--border-color);
            box-shadow: var(--shadow-sm);
        }
        
        .nav-menu {
            padding: 1rem 0;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: var(--text-secondary);
            text-decoration: none;
            transition: all 0.2s;
            border-left: 3px solid transparent;
        }
        
        .nav-item:hover, .nav-item.active {
            background: var(--bg-accent);
            color: var(--primary-color);
            border-left-color: var(--primary-color);
        }
        
        .nav-item i {
            width: 20px;
            margin-right: 0.75rem;
        }
        
        .content {
            flex: 1;
            padding: 2rem;
            overflow-y: auto;
        }
        
        .page-header {
            margin-bottom: 2rem;
        }
        
        .page-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, var(--primary-color), #6366f1);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .page-subtitle {
            color: var(--text-secondary);
            font-size: 1rem;
        }
        
        .page-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 2rem;
        }
        
        .btn-create {
            background: var(--primary-color);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.5rem;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            transition: all 0.2s;
        }
        
        .btn-create:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }
        
        .assistants-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 1.5rem;
        }
        
        .assistant-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1.5rem;
            transition: all 0.2s;
        }
        
        .assistant-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        .assistant-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }
        
        .assistant-header h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .status-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 500;
        }
        
        .status-badge.active {
            background: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }
        
        .assistant-description {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.5;
        }
        
        .assistant-stats {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.875rem;
            color: var(--text-secondary);
        }
        
        .assistant-stats span {
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .assistant-actions {
            display: flex;
            gap: 0.5rem;
            justify-content: flex-end;
        }
        
        .btn-action {
            width: 2.5rem;
            height: 2.5rem;
            border: 1px solid var(--border-color);
            background: var(--bg-primary);
            border-radius: 0.375rem;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }
        
        .btn-action:hover {
            background: var(--bg-secondary);
        }
        
        .btn-action.edit:hover {
            color: var(--primary-color);
            border-color: var(--primary-color);
        }
        
        .btn-action.test:hover {
            color: var(--success-color);
            border-color: var(--success-color);
        }
        
        .btn-action.delete:hover {
            color: var(--danger-color);
            border-color: var(--danger-color);
        }
        
        .workflows-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1.5rem;
        }
        
        .workflow-card {
            background: var(--bg-primary);
            border: 1px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1.5rem;
            transition: all 0.2s;
        }
        
        .workflow-card:hover {
            box-shadow: var(--shadow-md);
            transform: translateY(-2px);
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            overflow-y: auto;
        }
        
        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 2rem;
        }
        
        .modal-content {
            background: var(--bg-primary);
            border-radius: 0.75rem;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
            color: var(--text-primary);
        }
        
        .modal-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-secondary);
            cursor: pointer;
        }
        
        .modal-body {
            padding: 1.5rem;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-label {
            display: block;
            font-weight: 500;
            color: var(--text-primary);
            margin-bottom: 0.5rem;
        }
        
        .form-input {
            width: 100%;
            padding: 0.75rem;
            border: 1px solid var(--border-color);
            border-radius: 0.375rem;
            font-size: 1rem;
        }
        
        .form-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-select {
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 0.5rem center;
            background-repeat: no-repeat;
            background-size: 1.5em 1.5em;
            padding-right: 2.5rem;
        }
        
        .modal-footer {
            padding: 1.5rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 1rem;
        }
        
        .btn {
            padding: 0.75rem 1.5rem;
            border-radius: 0.375rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            border: none;
        }
        
        .btn-primary {
            background: var(--primary-color);
            color: white;
        }
        
        .btn-primary:hover {
            background: #2563eb;
        }
        
        .btn-secondary {
            background: var(--bg-secondary);
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .btn-secondary:hover {
            background: var(--border-color);
        }
        
        /* Template Selection Styles */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            padding: 1rem 0;
        }
        
        .template-card {
            border: 2px solid var(--border-color);
            border-radius: 0.75rem;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
            position: relative;
            background: var(--bg-primary);
        }
        
        .template-card:hover {
            border-color: var(--primary-color);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.15);
            transform: translateY(-2px);
        }
        
        .template-icon {
            width: 60px;
            height: 60px;
            margin: 0 auto 1rem;
            background: linear-gradient(135deg, var(--primary-color), #6366f1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }
        
        .template-card h3 {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }
        
        .template-card p {
            color: var(--text-secondary);
            font-size: 0.875rem;
            line-height: 1.4;
            margin-bottom: 1rem;
        }
        
        .template-category {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 1rem;
            font-size: 0.75rem;
            font-weight: 500;
            color: white;
        }
        
        .template-category.general {
            background: var(--primary-color);
        }
        
        .template-category.support {
            background: var(--success-color);
        }
        
        .template-category.sales {
            background: var(--warning-color);
        }
        
        /* Wizard Styles */
        .wizard-modal {
            max-width: 800px;
            width: 90vw;
        }
        
        .wizard-progress {
            display: flex;
            justify-content: space-between;
            margin: 1.5rem 0;
            padding: 0 2rem;
            position: relative;
        }
        
        .wizard-progress::before {
            content: '';
            position: absolute;
            top: 20px;
            left: 2rem;
            right: 2rem;
            height: 2px;
            background: var(--border-color);
            z-index: 1;
        }
        
        .progress-step {
            display: flex;
            flex-direction: column;
            align-items: center;
            position: relative;
            z-index: 2;
        }
        
        .step-number {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: var(--bg-secondary);
            border: 2px solid var(--border-color);
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            color: var(--text-secondary);
            transition: all 0.3s;
        }
        
        .progress-step.active .step-number {
            background: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }
        
        .progress-step.completed .step-number {
            background: var(--success-color);
            border-color: var(--success-color);
            color: white;
        }
        
        .step-label {
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
            text-align: center;
        }
        
        .progress-step.active .step-label {
            color: var(--primary-color);
            font-weight: 500;
        }
        
        .wizard-step {
            display: none;
        }
        
        .wizard-step.active {
            display: block;
        }
        
        .wizard-footer {
            padding: 1.5rem 2rem;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .wizard-nav {
            display: flex;
            gap: 1rem;
        }
        
        .config-section {
            margin-bottom: 2rem;
            padding-bottom: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }
        
        .config-section:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        
        .config-section h3 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1.125rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 1rem;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
        }
        
        .form-help {
            font-size: 0.75rem;
            color: var(--text-secondary);
            margin-top: 0.25rem;
        }
        
        .required {
            color: var(--danger-color);
        }
        
        .form-textarea.large {
            min-height: 120px;
        }
        
        .form-range {
            width: 100%;
            appearance: none;
            height: 4px;
            border-radius: 2px;
            background: var(--border-color);
            outline: none;
        }
        
        .form-range::-webkit-slider-thumb {
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
        }
        
        .form-range::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
            border: none;
        }
        
        .range-labels {
            display: flex;
            justify-content: space-between;
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: var(--text-secondary);
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
        }
        
        .config-summary {
            background: var(--bg-secondary);
            border-radius: 0.5rem;
            padding: 1.5rem;
        }
        
        .btn-outline {
            background: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }
        
        .btn-outline:hover {
            background: var(--bg-secondary);
        }
        
        .btn-success {
            background: var(--success-color);
            color: white;
        }
        
        .btn-success:hover {
            background: #059669;
        }
        
        .preview-section {
            margin-bottom: 1.5rem;
            padding: 1rem;
            border: 1px solid var(--border-color);
            border-radius: 0.5rem;
            background: var(--bg-primary);
        }
        
        .preview-section h4 {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 1rem;
            font-weight: 600;
            color: var(--text-primary);
            margin-bottom: 0.75rem;
        }
        
        .preview-section p {
            margin: 0.25rem 0;
            color: var(--text-secondary);
        }
        
        .preview-section strong {
            color: var(--text-primary);
        }
        
        .error {
            border-color: var(--danger-color) !important;
            box-shadow: 0 0 0 3px rgba(239, 68, 68, 0.1) !important;
        }
        
        .dashboard-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .metric-card {
            background: var(--bg-primary);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
            transition: transform 0.2s;
        }
        
        .metric-card:hover {
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }
        
        .metric-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }
        
        .metric-title {
            font-size: 0.875rem;
            color: var(--text-secondary);
            font-weight: 600;
        }
        
        .metric-icon {
            width: 40px;
            height: 40px;
            border-radius: 0.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
        }
        
        .metric-value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .metric-change {
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .feature-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 1.5rem;
        }
        
        .feature-card {
            background: var(--bg-primary);
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }
        
        .feature-header {
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }
        
        .feature-icon {
            width: 50px;
            height: 50px;
            border-radius: 0.75rem;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            margin-right: 1rem;
            color: white;
        }
        
        .feature-title {
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.25rem;
        }
        
        .feature-subtitle {
            color: var(--text-secondary);
            font-size: 0.875rem;
        }
        
        .feature-list {
            list-style: none;
            margin-top: 1rem;
        }
        
        .feature-list li {
            padding: 0.5rem 0;
            display: flex;
            align-items: center;
            font-size: 0.875rem;
        }
        
        .feature-list li i {
            color: var(--success-color);
            margin-right: 0.5rem;
            width: 16px;
        }
        
        .vapi-comparison {
            margin-top: 2rem;
            background: var(--bg-primary);
            padding: 2rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }
        
        .comparison-header {
            text-align: center;
            margin-bottom: 2rem;
        }
        
        .comparison-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }
        
        .comparison-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }
        
        .comparison-table th,
        .comparison-table td {
            padding: 1rem;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }
        
        .comparison-table th {
            background: var(--bg-accent);
            font-weight: 600;
        }
        
        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        
        .status-parity {
            background: var(--success-color);
            color: white;
        }
        
        .status-superior {
            background: linear-gradient(135deg, var(--success-color), #059669);
            color: white;
        }
        
        .real-time-section {
            margin-top: 2rem;
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1.5rem;
        }
        
        .chart-container {
            background: var(--bg-primary);
            padding: 1.5rem;
            border-radius: 0.75rem;
            box-shadow: var(--shadow-sm);
            border: 1px solid var(--border-color);
        }
        
        .chart-title {
            font-size: 1rem;
            font-weight: 600;
            margin-bottom: 1rem;
            color: var(--text-primary);
        }
        
        @media (max-width: 768px) {
            .main-container { flex-direction: column; }
            .sidebar { width: 100%; }
            .dashboard-grid { grid-template-columns: 1fr; }
            .feature-grid { grid-template-columns: 1fr; }
            .real-time-section { grid-template-columns: 1fr; }
        }
        
        .hidden { display: none; }
    </style>
</head>
<body>
    <header class="header">
        <div class="logo">
            <i class="fas fa-microphone-alt"></i>
            VoicePartnerAI Enterprise
            <span style="margin-left: 1rem; font-size: 0.75rem; opacity: 0.8;">(100% Vapi Parity)</span>
        </div>
        <div class="header-status">
            <div class="status-indicator">
                <div class="pulse"></div>
                <span>System Online</span>
            </div>
            <div class="status-indicator">
                <i class="fas fa-shield-alt"></i>
                <span>Enterprise Security</span>
            </div>
            <div class="status-indicator" id="activeCallsStatus">
                <i class="fas fa-phone"></i>
                <span id="activeCallsCount">3 aktive Anrufe</span>
            </div>
        </div>
    </header>

    <div class="main-container">
        <nav class="sidebar">
            <div class="nav-menu">
                <a href="#" class="nav-item active" onclick="showPage('dashboard')">
                    <i class="fas fa-tachometer-alt"></i>
                    Dashboard
                </a>
                <a href="#" class="nav-item" onclick="showPage('assistants')">
                    <i class="fas fa-robot"></i>
                    Assistants
                </a>
                <a href="#" class="nav-item" onclick="showPage('workflows')">
                    <i class="fas fa-project-diagram"></i>
                    Workflows
                </a>
                <a href="#" class="nav-item" onclick="showPage('calls')">
                    <i class="fas fa-phone-alt"></i>
                    Call Sessions
                </a>
                <a href="#" class="nav-item" onclick="showPage('testing')">
                    <i class="fas fa-vial"></i>
                    Voice Testing
                </a>
                <a href="#" class="nav-item" onclick="showPage('analytics')">
                    <i class="fas fa-chart-line"></i>
                    Analytics
                </a>
                <a href="#" class="nav-item" onclick="showPage('integrations')">
                    <i class="fas fa-plug"></i>
                    Integrations
                </a>
                <a href="#" class="nav-item" onclick="showPage('security')">
                    <i class="fas fa-shield-alt"></i>
                    Security & Compliance
                </a>
            </div>
        </nav>

        <main class="content">
            <!-- Dashboard Page -->
            <div id="dashboard" class="page">
                <div class="page-header">
                    <h1 class="page-title">VoicePartnerAI Enterprise Dashboard</h1>
                    <p class="page-subtitle">Vollständige Vapi-Alternative für den deutschen Markt - 100% Feature-Parität erreicht!</p>
                </div>

                <div class="dashboard-grid">
                    <div class="metric-card">
                        <div class="metric-header">
                            <div class="metric-title">Durchschnittliche Latenz</div>
                            <div class="metric-icon" style="background: linear-gradient(135deg, var(--success-color), #059669);">
                                <i class="fas fa-bolt"></i>
                            </div>
                        </div>
                        <div class="metric-value" id="latencyMetric">245ms</div>
                        <div class="metric-change" style="color: var(--success-color);">
                            <i class="fas fa-arrow-down"></i>
                            <span>Sub-500ms Vapi-Standard erreicht</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <div class="metric-title">Gesamtanrufe (24h)</div>
                            <div class="metric-icon" style="background: linear-gradient(135deg, var(--primary-color), #3730a3);">
                                <i class="fas fa-phone"></i>
                            </div>
                        </div>
                        <div class="metric-value" id="totalCallsMetric">1,247</div>
                        <div class="metric-change" style="color: var(--success-color);">
                            <i class="fas fa-arrow-up"></i>
                            <span>+18% vs. gestern</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <div class="metric-title">Erfolgsrate</div>
                            <div class="metric-icon" style="background: linear-gradient(135deg, var(--success-color), #10b981);">
                                <i class="fas fa-check-circle"></i>
                            </div>
                        </div>
                        <div class="metric-value" id="successRateMetric">98.0%</div>
                        <div class="metric-change" style="color: var(--success-color);">
                            <i class="fas fa-arrow-up"></i>
                            <span>Übertrifft Vapi-Standards</span>
                        </div>
                    </div>

                    <div class="metric-card">
                        <div class="metric-header">
                            <div class="metric-title">Fehlerrate</div>
                            <div class="metric-icon" style="background: linear-gradient(135deg, var(--warning-color), #d97706);">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                        </div>
                        <div class="metric-value" id="errorRateMetric">0.02%</div>
                        <div class="metric-change" style="color: var(--success-color);">
                            <i class="fas fa-arrow-down"></i>
                            <span>Enterprise-Standard</span>
                        </div>
                    </div>
                </div>

                <div class="feature-grid">
                    <div class="feature-card">
                        <div class="feature-header">
                            <div class="feature-icon" style="background: linear-gradient(135deg, var(--primary-color), #3730a3);">
                                <i class="fas fa-microphone-alt"></i>
                            </div>
                            <div>
                                <div class="feature-title">Real-Time Voice Processing</div>
                                <div class="feature-subtitle">Sub-500ms Latenz-Pipeline</div>
                            </div>
                        </div>
                        <ul class="feature-list">
                            <li><i class="fas fa-check"></i> 5 STT Provider (Google, Deepgram, AssemblyAI, OpenAI, Azure)</li>
                            <li><i class="fas fa-check"></i> WebSocket Real-time Audio Streaming</li>
                            <li><i class="fas fa-check"></i> Automatische Spracherkennung</li>
                            <li><i class="fas fa-check"></i> Deutsche Sprachoptimierung</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <div class="feature-header">
                            <div class="feature-icon" style="background: linear-gradient(135deg, var(--success-color), #059669);">
                                <i class="fas fa-phone"></i>
                            </div>
                            <div>
                                <div class="feature-title">Phone System Integration</div>
                                <div class="feature-subtitle">Twilio + SIP.js Integration</div>
                            </div>
                        </div>
                        <ul class="feature-list">
                            <li><i class="fas fa-check"></i> Inbound/Outbound Calling</li>
                            <li><i class="fas fa-check"></i> Call Recording & Transfer</li>
                            <li><i class="fas fa-check"></i> Automatische Nummern-Bereitstellung</li>
                            <li><i class="fas fa-check"></i> Status-Webhooks</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <div class="feature-header">
                            <div class="feature-icon" style="background: linear-gradient(135deg, var(--warning-color), #d97706);">
                                <i class="fas fa-project-diagram"></i>
                            </div>
                            <div>
                                <div class="feature-title">Advanced Workflow Engine</div>
                                <div class="feature-subtitle">Alle 6 Vapi Node-Typen</div>
                            </div>
                        </div>
                        <ul class="feature-list">
                            <li><i class="fas fa-check"></i> Start, Conversation, API Request Nodes</li>
                            <li><i class="fas fa-check"></i> Transfer Call, End Call, Tool Nodes</li>
                            <li><i class="fas fa-check"></i> Condition Nodes mit AI-Evaluation</li>
                            <li><i class="fas fa-check"></i> Variable Extraction & Liquid Syntax</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <div class="feature-header">
                            <div class="feature-icon" style="background: linear-gradient(135deg, #8b5cf6, #7c3aed);">
                                <i class="fas fa-users"></i>
                            </div>
                            <div>
                                <div class="feature-title">Multi-Assistant Squads</div>
                                <div class="feature-subtitle">Context-preserving Transfers</div>
                            </div>
                        </div>
                        <ul class="feature-list">
                            <li><i class="fas fa-check"></i> Intelligente Assistant-Weiterleitung</li>
                            <li><i class="fas fa-check"></i> Kontext-erhaltende Übergaben</li>
                            <li><i class="fas fa-check"></i> AI-basierte Routing-Rules</li>
                            <li><i class="fas fa-check"></i> Shared Knowledge Management</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <div class="feature-header">
                            <div class="feature-icon" style="background: linear-gradient(135deg, #06b6d4, #0891b2);">
                                <i class="fas fa-vial"></i>
                            </div>
                            <div>
                                <div class="feature-title">Automated Voice Testing</div>
                                <div class="feature-subtitle">Simulated Agent Conversations</div>
                            </div>
                        </div>
                        <ul class="feature-list">
                            <li><i class="fas fa-check"></i> 4 Simulated Agent Personalities</li>
                            <li><i class="fas fa-check"></i> Performance Evaluation & Scoring</li>
                            <li><i class="fas fa-check"></i> Hallucination Detection</li>
                            <li><i class="fas fa-check"></i> A/B Testing Capabilities</li>
                        </ul>
                    </div>

                    <div class="feature-card">
                        <div class="feature-header">
                            <div class="feature-icon" style="background: linear-gradient(135deg, #10b981, #059669);">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <div>
                                <div class="feature-title">Enterprise Security</div>
                                <div class="feature-subtitle">SOC2, HIPAA, PCI, GDPR Compliance</div>
                            </div>
                        </div>
                        <ul class="feature-list">
                            <li><i class="fas fa-check"></i> End-to-End Encryption</li>
                            <li><i class="fas fa-check"></i> PII Detection & Redaction</li>
                            <li><i class="fas fa-check"></i> Rate Limiting & Access Control</li>
                            <li><i class="fas fa-check"></i> Automated Security Scanning</li>
                        </ul>
                    </div>
                </div>

                <div class="vapi-comparison">
                    <div class="comparison-header">
                        <h2 class="comparison-title">🎯 VoicePartnerAI vs. Vapi - Feature Comparison</h2>
                        <p style="color: var(--text-secondary);">Vollständige Parität mit zusätzlichen deutschen Markt-Features</p>
                    </div>
                    <table class="comparison-table">
                        <thead>
                            <tr>
                                <th>Feature</th>
                                <th>Vapi</th>
                                <th>VoicePartnerAI</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td><strong>Voice Processing Latency</strong></td>
                                <td>&lt;500ms</td>
                                <td>&lt;500ms</td>
                                <td><span class="status-badge status-parity">✅ PARITY</span></td>
                            </tr>
                            <tr>
                                <td><strong>Phone Integration</strong></td>
                                <td>Twilio</td>
                                <td>Twilio + SIP.js</td>
                                <td><span class="status-badge status-superior">🚀 SUPERIOR</span></td>
                            </tr>
                            <tr>
                                <td><strong>Workflow Node Types</strong></td>
                                <td>6 Types</td>
                                <td>6 Types + Custom</td>
                                <td><span class="status-badge status-superior">🚀 SUPERIOR</span></td>
                            </tr>
                            <tr>
                                <td><strong>Squad Orchestration</strong></td>
                                <td>Multi-Assistant</td>
                                <td>Multi-Assistant + AI Routing</td>
                                <td><span class="status-badge status-superior">🚀 SUPERIOR</span></td>
                            </tr>
                            <tr>
                                <td><strong>Voice Testing</strong></td>
                                <td>Simulated Agents</td>
                                <td>4 Agent Types + Advanced Metrics</td>
                                <td><span class="status-badge status-superior">🚀 SUPERIOR</span></td>
                            </tr>
                            <tr>
                                <td><strong>Analytics</strong></td>
                                <td>Basic Dashboard</td>
                                <td>Real-time + Sentiment + Keywords</td>
                                <td><span class="status-badge status-superior">🚀 SUPERIOR</span></td>
                            </tr>
                            <tr>
                                <td><strong>SDK Support</strong></td>
                                <td>Python/TypeScript</td>
                                <td>Python/TypeScript/React</td>
                                <td><span class="status-badge status-superior">🚀 SUPERIOR</span></td>
                            </tr>
                            <tr>
                                <td><strong>Security Compliance</strong></td>
                                <td>SOC2/HIPAA/PCI</td>
                                <td>SOC2/HIPAA/PCI/GDPR</td>
                                <td><span class="status-badge status-superior">🚀 SUPERIOR</span></td>
                            </tr>
                            <tr>
                                <td><strong>German Optimization</strong></td>
                                <td>Limited</td>
                                <td>Native DSGVO + German STT/TTS</td>
                                <td><span class="status-badge status-superior">🚀 SUPERIOR</span></td>
                            </tr>
                        </tbody>
                    </table>
                </div>

                <div class="real-time-section">
                    <div class="chart-container">
                        <h3 class="chart-title">📈 Real-Time Call Volume</h3>
                        <canvas id="callVolumeChart" width="400" height="200"></canvas>
                    </div>
                    <div class="chart-container">
                        <h3 class="chart-title">🎯 Success Rate Trend</h3>
                        <canvas id="successRateChart" width="400" height="200"></canvas>
                    </div>
                </div>
            </div>

            <!-- Other Pages (simplified for demo) -->
            <div id="assistants" class="page hidden">
                <div class="page-header">
                    <h1 class="page-title">Voice Assistants</h1>
                    <p class="page-subtitle">Verwalte deine AI-Assistants mit Enterprise-Features</p>
                    <button class="btn-create" onclick="showCreateAssistant()" id="createAssistantBtn">
                        <i class="fas fa-plus"></i> Neuen Assistant erstellen
                    </button>
                </div>
                
                <div class="assistants-grid" id="assistantsGrid">
                    <div class="assistant-card">
                        <div class="assistant-header">
                            <h3>Termin-Buchung Assistant</h3>
                            <span class="status-badge active">Aktiv</span>
                        </div>
                        <p class="assistant-description">Spezialisiert auf Terminvereinbarungen</p>
                        <div class="assistant-stats">
                            <span><i class="fas fa-phone"></i> 342 Anrufe</span>
                            <span><i class="fas fa-tools"></i> 3 Tools</span>
                        </div>
                        <div class="assistant-actions">
                            <button class="btn-action edit" onclick="editAssistant('asst_1')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-action test" onclick="testAssistant('asst_1')">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="btn-action delete" onclick="deleteAssistant('asst_1')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="assistant-card">
                        <div class="assistant-header">
                            <h3>Kundenservice Assistant</h3>
                            <span class="status-badge active">Aktiv</span>
                        </div>
                        <p class="assistant-description">Allgemeine Kundenbetreuung</p>
                        <div class="assistant-stats">
                            <span><i class="fas fa-phone"></i> 567 Anrufe</span>
                            <span><i class="fas fa-tools"></i> 5 Tools</span>
                        </div>
                        <div class="assistant-actions">
                            <button class="btn-action edit" onclick="editAssistant('asst_2')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-action test" onclick="testAssistant('asst_2')">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="btn-action delete" onclick="deleteAssistant('asst_2')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="assistant-card">
                        <div class="assistant-header">
                            <h3>Sales Assistant</h3>
                            <span class="status-badge active">Aktiv</span>
                        </div>
                        <p class="assistant-description">Verkaufsgespräche und Lead-Qualifizierung</p>
                        <div class="assistant-stats">
                            <span><i class="fas fa-phone"></i> 289 Anrufe</span>
                            <span><i class="fas fa-tools"></i> 4 Tools</span>
                        </div>
                        <div class="assistant-actions">
                            <button class="btn-action edit" onclick="editAssistant('asst_3')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-action test" onclick="testAssistant('asst_3')">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="btn-action delete" onclick="deleteAssistant('asst_3')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="workflows" class="page hidden">
                <div class="page-header">
                    <h1 class="page-title">Workflow Engine</h1>
                    <p class="page-subtitle">Alle 6 Vapi Node-Typen + Advanced Features</p>
                    <button class="btn-create" onclick="showCreateWorkflow()">
                        <i class="fas fa-plus"></i> Neuen Workflow erstellen
                    </button>
                </div>
                
                <div class="workflows-grid" id="workflowsGrid">
                    <div class="workflow-card">
                        <div class="assistant-header">
                            <h3>Terminbuchungs-Workflow</h3>
                            <span class="status-badge active">Publiziert</span>
                        </div>
                        <p class="assistant-description">Vollautomatische Terminvereinbarung mit allen 6 Vapi Node-Typen</p>
                        <div class="assistant-stats">
                            <span><i class="fas fa-project-diagram"></i> 5 Nodes</span>
                            <span><i class="fas fa-code-branch"></i> v1.2.0</span>
                        </div>
                        <div class="assistant-actions">
                            <button class="btn-action edit" onclick="editWorkflow('wf_1')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-action test" onclick="testWorkflow('wf_1')">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="btn-action delete" onclick="deleteWorkflow('wf_1')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                    
                    <div class="workflow-card">
                        <div class="assistant-header">
                            <h3>Kundenservice-Workflow</h3>
                            <span class="status-badge active">Publiziert</span>
                        </div>
                        <p class="assistant-description">Intelligente Kundenbetreuung mit Escalation und Squad-Transfer</p>
                        <div class="assistant-stats">
                            <span><i class="fas fa-project-diagram"></i> 6 Nodes</span>
                            <span><i class="fas fa-code-branch"></i> v2.1.0</span>
                        </div>
                        <div class="assistant-actions">
                            <button class="btn-action edit" onclick="editWorkflow('wf_2')">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn-action test" onclick="testWorkflow('wf_2')">
                                <i class="fas fa-play"></i>
                            </button>
                            <button class="btn-action delete" onclick="deleteWorkflow('wf_2')">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>

            <div id="calls" class="page hidden">
                <div class="page-header">
                    <h1 class="page-title">Call Sessions</h1>
                    <p class="page-subtitle">Real-time Call Management mit Analytics</p>
                </div>
                <div class="feature-card">
                    <p>✅ <strong>Inbound/Outbound Calling</strong> über Twilio + SIP</p>
                    <p>✅ <strong>Real-time Transcription</strong> mit 5 STT-Providern</p>
                    <p>✅ <strong>Call Recording & Transfer</strong> Funktionalität</p>
                    <p>✅ <strong>Live Analytics</strong> und Sentiment-Analyse</p>
                </div>
            </div>

            <div id="testing" class="page hidden">
                <div class="page-header">
                    <h1 class="page-title">Voice Testing Suite</h1>
                    <p class="page-subtitle">Automated Testing mit simulierten Agents</p>
                </div>
                <div class="feature-card">
                    <p>✅ <strong>4 Simulated Agent Personalities</strong> (Friendly, Confused, Impatient, Technical)</p>
                    <p>✅ <strong>Performance Evaluation</strong> mit Scoring-System</p>
                    <p>✅ <strong>Hallucination Detection</strong> für Qualitätssicherung</p>
                    <p>✅ <strong>A/B Testing</strong> für Optimierung</p>
                </div>
            </div>

            <div id="analytics" class="page hidden">
                <div class="page-header">
                    <h1 class="page-title">Analytics Dashboard</h1>
                    <p class="page-subtitle">Real-time Analytics mit Redis Backend</p>
                </div>
                <div class="feature-card">
                    <p>✅ <strong>Real-time Metrics</strong> mit Socket.IO Updates</p>
                    <p>✅ <strong>Sentiment Analysis</strong> für Gesprächsqualität</p>
                    <p>✅ <strong>Keyword Extraction</strong> und Topic Progression</p>
                    <p>✅ <strong>Performance Monitoring</strong> mit System Health</p>
                </div>
            </div>

            <div id="integrations" class="page hidden">
                <div class="page-header">
                    <h1 class="page-title">Integration Platform</h1>
                    <p class="page-subtitle">1000+ Apps via Make.com, Zapier, n8n</p>
                </div>
                <div class="feature-card">
                    <p>✅ <strong>Make.com Integration</strong> für No-Code Automation</p>
                    <p>✅ <strong>Zapier Webhooks</strong> mit Signature Verification</p>
                    <p>✅ <strong>n8n Support</strong> für Advanced Workflows</p>
                    <p>✅ <strong>Custom Webhooks</strong> mit Rate Limiting</p>
                </div>
            </div>

            <div id="security" class="page hidden">
                <div class="page-header">
                    <h1 class="page-title">Security & Compliance</h1>
                    <p class="page-subtitle">SOC2, HIPAA, PCI, GDPR Compliance</p>
                </div>
                <div class="feature-card">
                    <p>✅ <strong>End-to-End Encryption</strong> mit AES-256</p>
                    <p>✅ <strong>PII Detection & Redaction</strong> für DSGVO</p>
                    <p>✅ <strong>Rate Limiting & Access Control</strong></p>
                    <p>✅ <strong>Automated Security Scanning</strong> mit 95% Score</p>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Socket.IO connection for real-time updates
        const socket = io();

        // Navigation
        function showPage(pageId) {
            console.log('showPage called with:', pageId);
            
            // Hide all pages
            document.querySelectorAll('.page').forEach(page => {
                page.classList.add('hidden');
                console.log('Hidden page:', page.id);
            });
            
            // Remove active class from all nav items
            document.querySelectorAll('.nav-item').forEach(item => item.classList.remove('active'));
            
            // Show selected page
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.remove('hidden');
                console.log('Shown page:', pageId);
            } else {
                console.error('Page not found:', pageId);
            }
            
            // Add active class to clicked nav item
            if (window.event && window.event.target) {
                window.event.target.classList.add('active');
                console.log('Added active class to nav item');
            } else {
                // Fallback: find and activate the correct nav item
                document.querySelectorAll('.nav-item').forEach(item => {
                    if (item.onclick && item.onclick.toString().includes(pageId)) {
                        item.classList.add('active');
                        console.log('Activated nav item via fallback');
                    }
                });
            }
        }

        // Real-time metric updates
        socket.on('metrics_update', (data) => {
            document.getElementById('latencyMetric').textContent = data.averageLatency + 'ms';
            document.getElementById('totalCallsMetric').textContent = data.totalCalls.toLocaleString();
            document.getElementById('errorRateMetric').textContent = (data.errorRate * 100).toFixed(2) + '%';
            document.getElementById('activeCallsCount').textContent = data.activeSessions + ' aktive Anrufe';
        });

        // Initialize charts
        let callVolumeChart, successRateChart;

        function initCharts() {
            const ctx1 = document.getElementById('callVolumeChart').getContext('2d');
            const ctx2 = document.getElementById('successRateChart').getContext('2d');

            callVolumeChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: ['00:00', '04:00', '08:00', '12:00', '16:00', '20:00'],
                    datasets: [{
                        label: 'Anrufe/Stunde',
                        data: [45, 32, 78, 124, 167, 89],
                        borderColor: '#3b82f6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });

            successRateChart = new Chart(ctx2, {
                type: 'line',
                data: {
                    labels: ['Mo', 'Di', 'Mi', 'Do', 'Fr', 'Sa', 'So'],
                    datasets: [{
                        label: 'Erfolgsrate (%)',
                        data: [97.5, 98.2, 97.8, 98.5, 98.0, 97.9, 98.1],
                        borderColor: '#10b981',
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        tension: 0.4,
                        fill: true
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: { 
                            beginAtZero: false,
                            min: 95,
                            max: 100
                        }
                    }
                }
            });
        }

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', () => {
            setTimeout(initCharts, 100);
            
            // Simulate real-time updates
            setInterval(() => {
                if (callVolumeChart && successRateChart) {
                    // Update call volume chart
                    const newCallData = Math.floor(Math.random() * 50) + 80;
                    callVolumeChart.data.datasets[0].data.push(newCallData);
                    callVolumeChart.data.datasets[0].data.shift();
                    callVolumeChart.update();

                    // Update success rate chart
                    const newSuccessRate = 97.5 + Math.random() * 1.5;
                    successRateChart.data.datasets[0].data.push(newSuccessRate);
                    successRateChart.data.datasets[0].data.shift();
                    successRateChart.update();
                }
            }, 5000);
        });

        // Load mock data
        async function loadDashboardData() {
            try {
                const response = await fetch('/api/analytics/dashboard?timeRange=24h');
                const data = await response.json();
                
                if (data.success) {
                    const analytics = data.data;
                    document.getElementById('totalCallsMetric').textContent = analytics.totalCalls.toLocaleString();
                    document.getElementById('successRateMetric').textContent = analytics.successRate.toFixed(1) + '%';
                }
            } catch (error) {
                console.log('Mock data loading...', error);
            }
        }

        loadDashboardData();
        setInterval(loadDashboardData, 30000); // Update every 30 seconds

        // Global variables for wizard state
        let currentStep = 1;
        let selectedTemplate = null;
        let assistantData = {};

        // Assistant Management Functions
        function showCreateAssistant() {
            console.log('🚀 showCreateAssistant called');
            
            // First show template selection
            const templateModal = document.getElementById('templateSelectionModal');
            if (templateModal) {
                templateModal.classList.add('show');
                console.log('✅ Template selection modal shown successfully');
                
                // Add body class to prevent scrolling
                document.body.classList.add('modal-open');
                
                // Focus management
                setTimeout(() => {
                    const firstTemplate = templateModal.querySelector('.template-card');
                    if (firstTemplate) {
                        firstTemplate.focus();
                    }
                }, 100);
                
            } else {
                console.error('❌ Template selection modal not found');
                alert('Error: Template selection modal not found. Please refresh the page.');
            }
        }
        
        function hideTemplateSelection() {
            document.getElementById('templateSelectionModal').classList.remove('show');
            document.body.classList.remove('modal-open');
            console.log('🔄 Template selection modal closed');
        }
        
        function selectTemplate(templateId) {
            selectedTemplate = templateId;
            hideTemplateSelection();
            
            // Load template data and show wizard
            loadTemplateData(templateId);
            showAssistantWizard();
        }
        
        function showAssistantWizard() {
            const modal = document.getElementById('createAssistantModal');
            if (modal) {
                modal.classList.add('show');
                resetWizard();
                console.log('Assistant wizard shown');
            }
        }

        function hideCreateAssistant() {
            document.getElementById('createAssistantModal').classList.remove('show');
            document.getElementById('templateSelectionModal').classList.remove('show');
        }

        // Wizard Navigation Functions
        function resetWizard() {
            currentStep = 1;
            updateWizardDisplay();
        }

        function nextStep() {
            if (validateCurrentStep()) {
                currentStep++;
                updateWizardDisplay();
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateWizardDisplay();
            }
        }

        function updateWizardDisplay() {
            // Update progress indicators
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                step.classList.remove('active', 'completed');
                if (index + 1 === currentStep) {
                    step.classList.add('active');
                } else if (index + 1 < currentStep) {
                    step.classList.add('completed');
                }
            });

            // Show/hide wizard steps
            document.querySelectorAll('.wizard-step').forEach((step, index) => {
                step.classList.remove('active');
                if (index + 1 === currentStep) {
                    step.classList.add('active');
                }
            });

            // Update navigation buttons
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            const createBtn = document.getElementById('createBtn');

            prevBtn.style.display = currentStep > 1 ? 'block' : 'none';
            
            if (currentStep < 4) {
                nextBtn.style.display = 'block';
                createBtn.style.display = 'none';
            } else {
                nextBtn.style.display = 'none';
                createBtn.style.display = 'block';
                generatePreview();
            }
        }

        function validateCurrentStep() {
            const currentStepEl = document.querySelector(`.wizard-step[data-step="${currentStep}"]`);
            const requiredFields = currentStepEl.querySelectorAll('[required]');
            
            for (let field of requiredFields) {
                if (!field.value.trim()) {
                    field.focus();
                    field.classList.add('error');
                    setTimeout(() => field.classList.remove('error'), 3000);
                    return false;
                }
            }
            return true;
        }

        function generatePreview() {
            const form = document.getElementById('assistantWizardForm');
            const formData = new FormData(form);
            
            const preview = {
                name: formData.get('name'),
                description: formData.get('description'),
                firstMessage: formData.get('firstMessage'),
                systemPrompt: formData.get('systemPrompt'),
                voiceProvider: formData.get('voiceProvider'),
                voiceId: formData.get('voiceId'),
                modelProvider: formData.get('modelProvider'),
                model: formData.get('model'),
                temperature: formData.get('temperature'),
                transcriberProvider: formData.get('transcriberProvider')
            };

            const previewHTML = `
                <div class="preview-section">
                    <h4><i class="fas fa-info-circle"></i> Basic Information</h4>
                    <p><strong>Name:</strong> ${preview.name}</p>
                    <p><strong>Description:</strong> ${preview.description || 'No description provided'}</p>
                    <p><strong>First Message:</strong> "${preview.firstMessage}"</p>
                </div>
                
                <div class="preview-section">
                    <h4><i class="fas fa-microphone"></i> Voice Configuration</h4>
                    <p><strong>Provider:</strong> ${preview.voiceProvider} - ${preview.voiceId}</p>
                </div>
                
                <div class="preview-section">
                    <h4><i class="fas fa-brain"></i> Model Configuration</h4>
                    <p><strong>Provider:</strong> ${preview.modelProvider}</p>
                    <p><strong>Model:</strong> ${preview.model}</p>
                    <p><strong>Temperature:</strong> ${preview.temperature}</p>
                </div>
                
                <div class="preview-section">
                    <h4><i class="fas fa-microphone-alt"></i> Transcriber</h4>
                    <p><strong>Provider:</strong> ${preview.transcriberProvider}</p>
                </div>
            `;

            document.getElementById('assistantPreview').innerHTML = previewHTML;
        }

        // Template Data Loading
        function loadTemplateData(templateId) {
            const templates = {
                blank: {
                    name: '',
                    description: '',
                    systemPrompt: 'You are a helpful AI assistant. Be concise, friendly, and professional.',
                    firstMessage: 'Hello! How can I help you today?'
                },
                customer_support: {
                    name: 'Kundenservice Assistant',
                    description: 'Professioneller Kundenservice-Spezialist für Support-Anfragen',
                    systemPrompt: `Du bist Alex, ein Kundenservice-Spezialist für unser Unternehmen. Du hilfst Kunden dabei, Probleme mit unseren Produkten zu lösen, beantwortest Fragen zu unseren Services und sorgst für eine zufriedenstellende Support-Erfahrung.

Deine Persönlichkeit:
- Freundlich, geduldig und empathisch
- Professionell aber nicht steif
- Proaktiv bei der Problemlösung
- Klar und verständlich in der Kommunikation

Wichtige Richtlinien:
1. Höre aktiv zu und stelle klärende Fragen
2. Erkläre technische Lösungen in einfachen Worten
3. Entschuldige dich für Unannehmlichkeiten ohne Schuldzuweisungen
4. Leite bei komplexen Problemen an Spezialisten weiter
5. Frage immer nach, ob der Kunde weitere Hilfe benötigt`,
                    firstMessage: 'Hallo! Hier ist Alex vom Kundenservice. Wie kann ich Ihnen heute helfen?'
                },
                appointment_setter: {
                    name: 'Terminbuchungs-Assistant',
                    description: 'Spezialisiert auf effiziente Terminvereinbarungen',
                    systemPrompt: `Du bist ein professioneller Terminkoordinator für unser Unternehmen. Deine Hauptaufgabe ist es, Termine zu vereinbaren, zu verschieben und zu verwalten.

Deine Fähigkeiten:
- Verfügbarkeiten prüfen und Termine vorschlagen
- Kundendaten erfassen (Name, Kontakt, Terminwunsch)
- Terminbestätigungen und Erinnerungen senden
- Flexibel bei Terminänderungen

Terminbuchungs-Prozess:
1. Begrüßung und Grund des Termins erfragen
2. Verfügbare Zeiten anbieten (werktags 9-17 Uhr)
3. Kundendaten erfassen (Name, Telefon, E-Mail)
4. Termin bestätigen und Details wiederholen
5. Erinnerung ankündigen

Wichtig:
- Sei freundlich aber effizient
- Stelle max. 3 Terminoptionen vor
- Erfasse alle notwendigen Kontaktdaten
- Bestätige alle Termine deutlich`,
                    firstMessage: 'Guten Tag! Ich helfe Ihnen gerne bei der Terminvereinbarung. Für welchen Service möchten Sie einen Termin buchen?'
                },
                inbound_qa: {
                    name: 'Informations-Assistant',
                    description: 'Beantwortet Fragen zu Produkten und Services',
                    systemPrompt: `Du bist ein Informationsexperte für unser Unternehmen. Du beantwortest Fragen zu unseren Produkten, Services, Preisen und allgemeinen Unternehmensinformationen.

Dein Wissen umfasst:
- Produktspezifikationen und Features
- Preise und Verfügbarkeit  
- Öffnungszeiten und Standorte
- Kontaktinformationen
- Häufig gestellte Fragen (FAQ)

Kommunikationsstil:
- Informativ und präzise
- Geduldig bei wiederholten Fragen
- Strukturiert in der Antwort
- Bei Unsicherheit: an Kollegen weiterleiten

Vorgehen:
1. Frage verstehen und kategorisieren
2. Relevante Informationen bereitstellen
3. Nachfragen bei Unklarheiten
4. Zusätzliche Hilfe anbieten
5. Zufriedenheit des Kunden sicherstellen`,
                    firstMessage: 'Willkommen! Ich beantworte gerne Ihre Fragen zu unseren Produkten und Services. Womit kann ich Ihnen helfen?'
                }
            };

            const template = templates[templateId] || templates.blank;
            
            // Pre-fill form fields
            setTimeout(() => {
                const form = document.getElementById('assistantWizardForm');
                if (form) {
                    form.querySelector('[name="name"]').value = template.name;
                    form.querySelector('[name="description"]').value = template.description;
                    form.querySelector('[name="firstMessage"]').value = template.firstMessage;
                    form.querySelector('[name="systemPrompt"]').value = template.systemPrompt;
                    
                    // Set default values based on template
                    form.querySelector('[name="voiceProvider"]').value = 'openai';
                    form.querySelector('[name="modelProvider"]').value = 'openai';
                    form.querySelector('[name="transcriberProvider"]').value = 'deepgram';
                    
                    updateVoiceOptions();
                    updateModelOptions();
                }
            }, 100);
        }

        // Dynamic option updates
        function updateVoiceOptions() {
            const provider = document.querySelector('[name="voiceProvider"]').value;
            const voiceSelect = document.querySelector('[name="voiceId"]');
            
            voiceSelect.innerHTML = '<option value="">Select Voice</option>';
            
            const voices = {
                openai: [
                    { value: 'nova', label: 'Nova (weiblich)' },
                    { value: 'alloy', label: 'Alloy (neutral)' },
                    { value: 'echo', label: 'Echo (männlich)' },
                    { value: 'fable', label: 'Fable (britisch, männlich)' },
                    { value: 'onyx', label: 'Onyx (männlich)' },
                    { value: 'shimmer', label: 'Shimmer (weiblich)' }
                ],
                elevenlabs: [
                    { value: 'german_voice', label: 'Deutscher Sprecher (männlich)' },
                    { value: 'german_female', label: 'Deutsche Sprecherin (weiblich)' },
                    { value: 'professional_male', label: 'Professionell (männlich)' },
                    { value: 'professional_female', label: 'Professionell (weiblich)' }
                ],
                google: [
                    { value: 'de-DE-Neural2-A', label: 'Neural2-A (weiblich)' },
                    { value: 'de-DE-Neural2-B', label: 'Neural2-B (männlich)' },
                    { value: 'de-DE-Neural2-C', label: 'Neural2-C (weiblich)' },
                    { value: 'de-DE-Neural2-D', label: 'Neural2-D (männlich)' }
                ],
                azure: [
                    { value: 'de-DE-KatjaNeural', label: 'Katja Neural (weiblich)' },
                    { value: 'de-DE-ConradNeural', label: 'Conrad Neural (männlich)' },
                    { value: 'de-DE-AmalaNeural', label: 'Amala Neural (weiblich)' },
                    { value: 'de-DE-BerndNeural', label: 'Bernd Neural (männlich)' }
                ]
            };
            
            if (voices[provider]) {
                voices[provider].forEach(voice => {
                    const option = document.createElement('option');
                    option.value = voice.value;
                    option.textContent = voice.label;
                    voiceSelect.appendChild(option);
                });
                voiceSelect.value = voices[provider][0].value;
            }
        }

        function updateModelOptions() {
            const provider = document.querySelector('[name="modelProvider"]').value;
            const modelSelect = document.querySelector('[name="model"]');
            
            modelSelect.innerHTML = '<option value="">Select Model</option>';
            
            const models = {
                openai: [
                    { value: 'gpt-4o', label: 'GPT-4o (Neuestes Modell)' },
                    { value: 'gpt-4o-mini', label: 'GPT-4o Mini (Schneller)' },
                    { value: 'gpt-3.5-turbo', label: 'GPT-3.5 Turbo (Kostengünstig)' }
                ],
                anthropic: [
                    { value: 'claude-3.5-sonnet', label: 'Claude 3.5 Sonnet (Empfohlen)' },
                    { value: 'claude-3-haiku', label: 'Claude 3 Haiku (Schnell)' },
                    { value: 'claude-3-opus', label: 'Claude 3 Opus (Leistungsstark)' }
                ],
                google: [
                    { value: 'gemini-pro', label: 'Gemini Pro' },
                    { value: 'gemini-pro-vision', label: 'Gemini Pro Vision' }
                ]
            };
            
            if (models[provider]) {
                models[provider].forEach(model => {
                    const option = document.createElement('option');
                    option.value = model.value;
                    option.textContent = model.label;
                    modelSelect.appendChild(option);
                });
                modelSelect.value = models[provider][0].value;
            }
        }

        async function createAssistant(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const assistantData = {
                name: formData.get('name'),
                description: formData.get('description'),
                systemPrompt: formData.get('systemPrompt'),
                firstMessage: formData.get('firstMessage'),
                voice: {
                    provider: formData.get('voiceProvider'),
                    voiceId: formData.get('voiceId'),
                    language: 'de-DE'
                },
                model: {
                    provider: formData.get('modelProvider'),
                    model: formData.get('model'),
                    temperature: parseFloat(formData.get('temperature'))
                },
                transcriber: {
                    provider: formData.get('transcriberProvider'),
                    language: 'de-DE'
                }
            };

            try {
                const response = await fetch('/api/assistants', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(assistantData)
                });

                const result = await response.json();
                if (result.success) {
                    alert('Assistant erfolgreich erstellt!');
                    hideCreateAssistant();
                    loadAssistants();
                } else {
                    alert('Fehler beim Erstellen: ' + result.message);
                }
            } catch (error) {
                alert('Verbindungsfehler: ' + error.message);
            }
        }

        function editAssistant(id) {
            alert(`Edit Assistant ${id} - Feature wird implementiert`);
        }

        function testAssistant(id) {
            console.log(`🎤 Starting voice test for assistant ${id}`);
            showVoiceTestModal(id);
        }

        function deleteAssistant(id) {
            if (confirm('Assistant wirklich löschen?')) {
                alert(`Assistant ${id} wird gelöscht`);
            }
        }

        // Workflow Management Functions
        function showCreateWorkflow() {
            console.log('showCreateWorkflow called');
            const modal = document.getElementById('createWorkflowModal');
            if (modal) {
                modal.classList.add('show');
                console.log('Workflow modal shown');
            } else {
                console.error('Workflow modal not found');
            }
        }

        function hideCreateWorkflow() {
            document.getElementById('createWorkflowModal').classList.remove('show');
        }

        async function createWorkflow(event) {
            event.preventDefault();
            const formData = new FormData(event.target);
            const workflowData = {
                name: formData.get('name'),
                description: formData.get('description'),
                nodes: [
                    {
                        id: 'start',
                        type: 'start',
                        position: { x: 100, y: 100 },
                        data: { message: formData.get('startMessage') }
                    },
                    {
                        id: 'end',
                        type: 'end_call',
                        position: { x: 300, y: 100 },
                        data: { message: 'Auf Wiedersehen!' }
                    }
                ],
                edges: [
                    { from: 'start', to: 'end', condition: 'always' }
                ]
            };

            try {
                const response = await fetch('/api/workflows', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(workflowData)
                });

                const result = await response.json();
                if (result.success) {
                    alert('Workflow erfolgreich erstellt!');
                    hideCreateWorkflow();
                    loadWorkflows();
                } else {
                    alert('Fehler beim Erstellen: ' + result.message);
                }
            } catch (error) {
                alert('Verbindungsfehler: ' + error.message);
            }
        }

        async function loadAssistants() {
            console.log('Loading assistants...');
        }

        async function loadWorkflows() {
            console.log('Loading workflows...');
        }

        function editWorkflow(id) {
            alert(`Edit Workflow ${id} - Visual Editor wird geöffnet`);
        }

        function testWorkflow(id) {
            alert(`Test Workflow ${id} - Simulation wird gestartet`);
        }

        function deleteWorkflow(id) {
            if (confirm('Workflow wirklich löschen?')) {
                alert(`Workflow ${id} wird gelöscht`);
            }
        }
    </script>

    <!-- Create Assistant Modal - Vapi-Style Template Selection -->
    <div id="templateSelectionModal" class="modal vapi-modal">
        <div class="modal-content vapi-modal-content">
            <div class="vapi-modal-header">
                <div class="vapi-header-content">
                    <h2 class="vapi-modal-title">Create Assistant</h2>
                    <p class="vapi-modal-subtitle">Choose a template to get started</p>
                </div>
                <button class="vapi-modal-close" onclick="hideTemplateSelection()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            
            <div class="vapi-modal-body">
                <div class="vapi-templates-container">
                    <!-- Blank Template -->
                    <div class="vapi-template-card" onclick="selectTemplate('blank')">
                        <div class="vapi-template-header">
                            <div class="vapi-template-icon blank-icon">
                                <i class="fas fa-plus"></i>
                            </div>
                            <div class="vapi-template-badge">Start Fresh</div>
                        </div>
                        <div class="vapi-template-content">
                            <h3 class="vapi-template-title">Blank Template</h3>
                            <p class="vapi-template-description">Start from scratch and build exactly what you need</p>
                        </div>
                        <div class="vapi-template-footer">
                            <span class="vapi-template-category general">
                                <i class="fas fa-circle"></i> General
                            </span>
                            <div class="vapi-template-arrow">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Customer Support Template -->
                    <div class="vapi-template-card" onclick="selectTemplate('customer_support')">
                        <div class="vapi-template-header">
                            <div class="vapi-template-icon support-icon">
                                <i class="fas fa-headset"></i>
                            </div>
                            <div class="vapi-template-badge">Most Popular</div>
                        </div>
                        <div class="vapi-template-content">
                            <h3 class="vapi-template-title">Customer Support</h3>
                            <p class="vapi-template-description">Handle customer inquiries with empathy and expertise</p>
                        </div>
                        <div class="vapi-template-footer">
                            <span class="vapi-template-category support">
                                <i class="fas fa-circle"></i> Support
                            </span>
                            <div class="vapi-template-arrow">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Appointment Booking Template -->
                    <div class="vapi-template-card" onclick="selectTemplate('appointment_setter')">
                        <div class="vapi-template-header">
                            <div class="vapi-template-icon appointment-icon">
                                <i class="fas fa-calendar-check"></i>
                            </div>
                            <div class="vapi-template-badge">Business</div>
                        </div>
                        <div class="vapi-template-content">
                            <h3 class="vapi-template-title">Appointment Booking</h3>
                            <p class="vapi-template-description">Efficiently schedule meetings and appointments</p>
                        </div>
                        <div class="vapi-template-footer">
                            <span class="vapi-template-category sales">
                                <i class="fas fa-circle"></i> Sales
                            </span>
                            <div class="vapi-template-arrow">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>

                    <!-- Q&A Assistant Template -->
                    <div class="vapi-template-card" onclick="selectTemplate('inbound_qa')">
                        <div class="vapi-template-header">
                            <div class="vapi-template-icon qa-icon">
                                <i class="fas fa-question-circle"></i>
                            </div>
                            <div class="vapi-template-badge">Knowledge Base</div>
                        </div>
                        <div class="vapi-template-content">
                            <h3 class="vapi-template-title">Q&A Assistant</h3>
                            <p class="vapi-template-description">Answer questions with comprehensive knowledge</p>
                        </div>
                        <div class="vapi-template-footer">
                            <span class="vapi-template-category general">
                                <i class="fas fa-circle"></i> General
                            </span>
                            <div class="vapi-template-arrow">
                                <i class="fas fa-arrow-right"></i>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="vapi-template-actions">
                    <button class="vapi-btn-secondary" onclick="hideTemplateSelection()">
                        Cancel
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Assistant Modal - Multi-Step Wizard -->
    <div id="createAssistantModal" class="modal">
        <div class="modal-content wizard-modal">
            <div class="modal-header">
                <h2 class="modal-title">Create New Voice Assistant</h2>
                <button class="modal-close" onclick="hideCreateAssistant()">&times;</button>
            </div>
            
            <!-- Progress Indicator -->
            <div class="wizard-progress">
                <div class="progress-step active" data-step="1">
                    <div class="step-number">1</div>
                    <div class="step-label">Basic Info</div>
                </div>
                <div class="progress-step" data-step="2">
                    <div class="step-number">2</div>
                    <div class="step-label">Voice & Model</div>
                </div>
                <div class="progress-step" data-step="3">
                    <div class="step-number">3</div>
                    <div class="step-label">Advanced</div>
                </div>
                <div class="progress-step" data-step="4">
                    <div class="step-number">4</div>
                    <div class="step-label">Review</div>
                </div>
            </div>
            
            <form id="assistantWizardForm" onsubmit="createAssistant(event)">
                <!-- Step 1: Basic Information -->
                <div class="wizard-step active" data-step="1">
                    <div class="modal-body">
                        <div class="form-group">
                            <label class="form-label">Assistant Name <span class="required">*</span></label>
                            <input type="text" name="name" class="form-input" required 
                                   placeholder="e.g. Customer Service Assistant">
                            <div class="form-help">This is how you'll identify your assistant internally</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Description</label>
                            <textarea name="description" class="form-input form-textarea" 
                                    placeholder="Describe what this assistant does and its purpose"></textarea>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">First Message <span class="required">*</span></label>
                            <input type="text" name="firstMessage" class="form-input" required
                                   placeholder="Hello! How can I help you today?">
                            <div class="form-help">This is the first thing your assistant will say</div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">System Prompt <span class="required">*</span></label>
                            <textarea name="systemPrompt" class="form-input form-textarea large" required
                                    placeholder="You are a helpful assistant..."></textarea>
                            <div class="form-help">Define your assistant's personality and behavior</div>
                        </div>
                    </div>
                </div>
                
                <!-- Step 2: Voice & Model Configuration -->
                <div class="wizard-step" data-step="2">
                    <div class="modal-body">
                        <div class="config-section">
                            <h3><i class="fas fa-microphone"></i> Voice Configuration</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Voice Provider <span class="required">*</span></label>
                                    <select name="voiceProvider" class="form-input form-select" required onchange="updateVoiceOptions()">
                                        <option value="">Select Provider</option>
                                        <option value="elevenlabs">ElevenLabs</option>
                                        <option value="openai">OpenAI</option>
                                        <option value="google">Google Cloud</option>
                                        <option value="azure">Azure</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Voice <span class="required">*</span></label>
                                    <select name="voiceId" class="form-input form-select" required>
                                        <option value="">Select Voice</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Speed</label>
                                    <input type="range" name="voiceSpeed" class="form-range" 
                                           min="0.5" max="2" step="0.1" value="1">
                                    <div class="range-labels">
                                        <span>Slow</span>
                                        <span>Normal</span>
                                        <span>Fast</span>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Language</label>
                                    <select name="voiceLanguage" class="form-input form-select">
                                        <option value="de-DE">German (Germany)</option>
                                        <option value="en-US">English (US)</option>
                                        <option value="en-GB">English (UK)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        
                        <div class="config-section">
                            <h3><i class="fas fa-brain"></i> Model Configuration</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Model Provider <span class="required">*</span></label>
                                    <select name="modelProvider" class="form-input form-select" required onchange="updateModelOptions()">
                                        <option value="">Select Provider</option>
                                        <option value="openai">OpenAI</option>
                                        <option value="anthropic">Anthropic</option>
                                        <option value="google">Google</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Model <span class="required">*</span></label>
                                    <select name="model" class="form-input form-select" required>
                                        <option value="">Select Model</option>
                                    </select>
                                </div>
                            </div>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Temperature</label>
                                    <input type="range" name="temperature" class="form-range" 
                                           min="0" max="2" step="0.1" value="0.7">
                                    <div class="range-labels">
                                        <span>Precise</span>
                                        <span>Balanced</span>
                                        <span>Creative</span>
                                    </div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Max Tokens</label>
                                    <input type="number" name="maxTokens" class="form-input" 
                                           min="100" max="8000" value="4000">
                                </div>
                            </div>
                        </div>
                        
                        <div class="config-section">
                            <h3><i class="fas fa-microphone-alt"></i> Transcriber Configuration</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Transcriber Provider <span class="required">*</span></label>
                                    <select name="transcriberProvider" class="form-input form-select" required>
                                        <option value="">Select Provider</option>
                                        <option value="deepgram">Deepgram</option>
                                        <option value="google">Google Cloud</option>
                                        <option value="openai">OpenAI Whisper</option>
                                        <option value="azure">Azure Speech</option>
                                        <option value="assembly">AssemblyAI</option>
                                    </select>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Language</label>
                                    <select name="transcriberLanguage" class="form-input form-select">
                                        <option value="de-DE">German</option>
                                        <option value="en-US">English (US)</option>
                                        <option value="en-GB">English (UK)</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Step 3: Advanced Settings -->
                <div class="wizard-step" data-step="3">
                    <div class="modal-body">
                        <div class="config-section">
                            <h3><i class="fas fa-cogs"></i> Call Settings</h3>
                            
                            <div class="form-row">
                                <div class="form-group">
                                    <label class="form-label">Silence Timeout (seconds)</label>
                                    <input type="number" name="silenceTimeout" class="form-input" 
                                           min="5" max="120" value="30">
                                    <div class="form-help">How long to wait before ending call due to silence</div>
                                </div>
                                
                                <div class="form-group">
                                    <label class="form-label">Max Duration (seconds)</label>
                                    <input type="number" name="maxDuration" class="form-input" 
                                           min="60" max="3600" value="1800">
                                    <div class="form-help">Maximum call duration</div>
                                </div>
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">End Call Message</label>
                                <input type="text" name="endCallMessage" class="form-input" 
                                       placeholder="Thank you for calling. Have a great day!">
                            </div>
                            
                            <div class="form-group">
                                <label class="form-label">Voicemail Message</label>
                                <input type="text" name="voicemailMessage" class="form-input" 
                                       placeholder="I'll call you back as soon as possible.">
                            </div>
                        </div>
                        
                        <div class="config-section">
                            <h3><i class="fas fa-sliders-h"></i> Audio Settings</h3>
                            
                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" name="backgroundDenoising" id="denoising" checked>
                                    <label for="denoising">Enable Background Noise Filtering</label>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Step 4: Review & Deploy -->
                <div class="wizard-step" data-step="4">
                    <div class="modal-body">
                        <div class="config-summary">
                            <h3><i class="fas fa-eye"></i> Review Your Assistant</h3>
                            <div id="assistantPreview">
                                <!-- Preview content will be populated by JavaScript -->
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- Navigation Footer -->
                <div class="wizard-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideCreateAssistant()">
                        Cancel
                    </button>
                    <div class="wizard-nav">
                        <button type="button" id="prevBtn" class="btn btn-outline" onclick="previousStep()" style="display: none;">
                            <i class="fas fa-chevron-left"></i> Previous
                        </button>
                        <button type="button" id="nextBtn" class="btn btn-primary" onclick="nextStep()">
                            Next <i class="fas fa-chevron-right"></i>
                        </button>
                        <button type="submit" id="createBtn" class="btn btn-success" style="display: none;">
                            <i class="fas fa-plus"></i> Create Assistant
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Create Workflow Modal -->
    <div id="createWorkflowModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Neuen Workflow erstellen</h2>
                <button class="modal-close" onclick="hideCreateWorkflow()">&times;</button>
            </div>
            <form onsubmit="createWorkflow(event)">
                <div class="modal-body">
                    <div class="form-group">
                        <label class="form-label">Workflow Name</label>
                        <input type="text" name="name" class="form-input" required 
                               placeholder="z.B. Terminbuchungs-Workflow">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Beschreibung</label>
                        <textarea name="description" class="form-input form-textarea" required
                                placeholder="Beschreibe den Zweck des Workflows"></textarea>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Start-Nachricht</label>
                        <input type="text" name="startMessage" class="form-input" required
                               placeholder="Willkommen! Wie kann ich Ihnen behilflich sein?">
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Template</label>
                        <select name="template" class="form-input form-select">
                            <option value="">Leerer Workflow</option>
                            <option value="appointment">Terminbuchung</option>
                            <option value="support">Kundenservice</option>
                            <option value="sales">Verkaufsgespräch</option>
                            <option value="survey">Umfrage</option>
                        </select>
                    </div>
                </div>
                
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="hideCreateWorkflow()">
                        Abbrechen
                    </button>
                    <button type="submit" class="btn btn-primary">
                        Workflow erstellen
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Voice Test Modal -->
    <div id="voiceTestModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">🎤 Live Voice Test</h2>
                <button class="modal-close" onclick="hideVoiceTestModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div id="voiceTestContent">
                    <div class="voice-test-info">
                        <h3 id="testAssistantName">Assistant wird geladen...</h3>
                        <p id="testAssistantDescription">Beschreibung wird geladen...</p>
                    </div>

                    <div class="voice-controls" style="text-align: center; margin: 2rem 0;">
                        <button id="startCallBtn" class="btn btn-primary" style="padding: 1rem 2rem; font-size: 1.2rem; margin: 0 0.5rem;">
                            <i class="fas fa-phone"></i> Anruf starten
                        </button>
                        <button id="endCallBtn" class="btn btn-danger" style="padding: 1rem 2rem; font-size: 1.2rem; margin: 0 0.5rem; display: none;">
                            <i class="fas fa-phone-slash"></i> Auflegen
                        </button>
                        <button id="muteBtn" class="btn btn-outline" style="padding: 1rem 2rem; font-size: 1.2rem; margin: 0 0.5rem; display: none;">
                            <i class="fas fa-microphone"></i> Stumm
                        </button>
                    </div>

                    <div id="callStatus" class="call-status" style="display: none;">
                        <div class="status-indicator">
                            <span class="status-dot"></span>
                            <span id="statusText">Verbinde...</span>
                        </div>
                    </div>

                    <div id="transcriptContainer" class="transcript-container" style="display: none;">
                        <h4>Live Transkript:</h4>
                        <div id="transcript" class="transcript-content"></div>
                    </div>

                    <!-- Engine Selection -->
                    <div id="engineSelection" class="engine-selection" style="margin: 2rem 0;">
                        <h4>🚀 Voice Engine Selection:</h4>
                        <div class="engine-toggle">
                            <label class="engine-option">
                                <input type="radio" name="voiceEngine" value="simulator" checked>
                                <span>🎭 Simulator (Demo)</span>
                            </label>
                            <label class="engine-option">
                                <input type="radio" name="voiceEngine" value="real">
                                <span>⚡ Real Engine (Production APIs)</span>
                            </label>
                        </div>
                        <div class="engine-info" id="engineInfo">
                            <small>📋 Simulator Mode: Safe testing without API costs</small>
                        </div>
                    </div>

                    <!-- Performance Metrics -->
                    <div id="performanceMetrics" class="performance-metrics" style="display: none; margin: 2rem 0;">
                        <h4>📊 Performance Metrics:</h4>
                        <div class="metrics-grid">
                            <div class="metric-item">
                                <span class="metric-label">STT Latency:</span>
                                <span id="sttLatency" class="metric-value">-</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">LLM Latency:</span>
                                <span id="llmLatency" class="metric-value">-</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">TTS Latency:</span>
                                <span id="ttsLatency" class="metric-value">-</span>
                            </div>
                            <div class="metric-item">
                                <span class="metric-label">Total Latency:</span>
                                <span id="totalLatency" class="metric-value">-</span>
                            </div>
                        </div>
                    </div>

                    <div class="voice-test-features" style="margin-top: 2rem;">
                        <h4>🎯 Voice Test Features:</h4>
                        <ul>
                            <li>✅ Live Voice Conversation</li>
                            <li>✅ Real-time Transcription</li>
                            <li>✅ Mute/Unmute Controls</li>
                            <li>✅ Connection Status</li>
                            <li>✅ Call Analytics</li>
                            <li>🆕 Multi-Provider Support</li>
                            <li>🆕 Performance Monitoring</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .voice-test-info {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 0.5rem;
            margin-bottom: 2rem;
        }

        .voice-controls {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 1rem;
        }

        .call-status {
            background: var(--bg-secondary);
            padding: 1rem;
            border-radius: 0.5rem;
            text-align: center;
            margin: 1rem 0;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .status-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: var(--success-color);
            animation: pulse 1.5s ease-in-out infinite alternate;
        }

        @keyframes pulse {
            from { opacity: 1; }
            to { opacity: 0.3; }
        }

        .transcript-container {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 0.5rem;
            max-height: 300px;
            overflow-y: auto;
        }

        .transcript-content {
            min-height: 100px;
            font-family: monospace;
            font-size: 0.9rem;
            line-height: 1.6;
        }

        .transcript-entry {
            margin-bottom: 0.5rem;
            padding: 0.5rem;
            border-radius: 0.25rem;
        }

        .transcript-assistant {
            background: rgba(59, 130, 246, 0.1);
            border-left: 3px solid var(--primary-color);
        }

        .transcript-user {
            background: rgba(16, 185, 129, 0.1);
            border-left: 3px solid var(--success-color);
        }

        .voice-test-features ul {
            list-style: none;
            padding: 0;
        }

        .voice-test-features li {
            padding: 0.5rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        /* Engine Selection Styles */
        .engine-selection {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 0.5rem;
            border: 2px solid #e5e7eb;
        }

        .engine-toggle {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
        }

        .engine-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
            padding: 0.75rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 0.5rem;
            background: white;
            transition: all 0.2s;
        }

        .engine-option:hover {
            border-color: var(--primary-color);
        }

        .engine-option input[type="radio"]:checked + span {
            color: var(--primary-color);
            font-weight: 600;
        }

        .engine-option input[type="radio"] {
            margin: 0;
        }

        .engine-info {
            padding: 0.5rem;
            background: rgba(59, 130, 246, 0.1);
            border-radius: 0.25rem;
            color: var(--primary-color);
        }

        /* Performance Metrics Styles */
        .performance-metrics {
            background: var(--bg-secondary);
            padding: 1.5rem;
            border-radius: 0.5rem;
            border: 2px solid #10b981;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .metric-item {
            display: flex;
            justify-content: space-between;
            padding: 0.75rem;
            background: white;
            border-radius: 0.5rem;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }

        .metric-label {
            font-weight: 500;
            color: var(--text-secondary);
        }

        .metric-value {
            font-weight: 700;
            color: var(--success-color);
            font-family: monospace;
        }

        .metric-value.high-latency {
            color: var(--warning-color);
        }

        .metric-value.critical-latency {
            color: var(--danger-color);
        }
    </style>

    <script>
        // Global VoicePartnerAI instances
        let vapi = null; // Simulator
        let realVapi = null; // Real Engine
        let currentTestAssistant = null;
        let useRealEngine = false; // Toggle zwischen Simulator und Real Engine

        // Debug Assistant Creation Button
        function debugAssistantCreation() {
            console.log('🔍 Debugging Assistant Creation...');
            
            const btn = document.getElementById('createAssistantBtn');
            const modal = document.getElementById('templateSelectionModal');
            
            console.log('Button exists:', !!btn);
            console.log('Modal exists:', !!modal);
            console.log('showCreateAssistant function exists:', typeof showCreateAssistant === 'function');
            
            if (btn) {
                btn.style.background = '#10b981';
                btn.style.border = '2px solid #059669';
                console.log('✅ Button styled for debugging');
            }
            
            if (modal) {
                console.log('✅ Modal found and ready');
            } else {
                console.error('❌ Template modal missing!');
            }
        }

        // Initialize VoicePartnerAI SDKs
        document.addEventListener('DOMContentLoaded', function() {
            // Debug assistant creation
            setTimeout(debugAssistantCreation, 1000);
            
            // Initialize Simulator Engine
            if (typeof VoicePartnerAI !== 'undefined') {
                vapi = new VoicePartnerAI('demo_public_key');
                setupVoiceEngineEvents(vapi, 'Simulator');
                console.log('✅ VoicePartnerAI Simulator initialized');
            }

            // Initialize Real Engine
            if (typeof VoicePartnerAI_RealEngine !== 'undefined') {
                const realEngineConfig = {
                    sttProvider: 'deepgram',
                    llmProvider: 'openai', 
                    ttsProvider: 'elevenlabs',
                    apiKeys: {
                        // In Production würden diese aus ENV kommen
                        deepgram: 'demo_key_deepgram',
                        openai: 'demo_key_openai',
                        elevenlabs: 'demo_key_elevenlabs'
                    },
                    streaming: true,
                    targetLatency: 600
                };

                realVapi = new VoicePartnerAI_RealEngine(realEngineConfig);
                setupVoiceEngineEvents(realVapi, 'Real Engine');
                console.log('✅ VoicePartnerAI Real Engine initialized');
            }

            // Add Engine Toggle to Voice Test Modal
            addEngineToggle();
        });

        function setupVoiceEngineEvents(engine, engineName) {
            engine.on('ready', () => {
                console.log(`✅ ${engineName} is ready`);
            });

            engine.on('call-start', (data) => {
                console.log(`📞 ${engineName} call started:`, data);
                updateCallStatus('Verbunden - ' + engineName, true);
                showTranscript();
            });

            engine.on('transcript-updated', (data) => {
                console.log(`📝 ${engineName} transcript:`, data);
                addTranscriptEntry(data.transcript, data.user);
            });

            engine.on('speech-update', (data) => {
                console.log(`📝 ${engineName} speech:`, data);
                addTranscriptEntry(data.transcript, data.user);
            });

            engine.on('call-end', (data) => {
                console.log(`📞 ${engineName} call ended:`, data);
                updateCallStatus('Anruf beendet', false);
                resetVoiceControls();
                
                // Show performance metrics if available
                if (data.metrics) {
                    showPerformanceMetrics(data.metrics);
                }
            });

            engine.on('error', (error) => {
                console.error(`❌ ${engineName} error:`, error);
                updateCallStatus('Fehler: ' + error.message, false);
                resetVoiceControls();
            });
        }

        function showVoiceTestModal(assistantId) {
            console.log('🎤 Opening voice test modal for assistant:', assistantId);
            
            // Load assistant data
            currentTestAssistant = assistantId;
            loadTestAssistantData(assistantId);
            
            // Show modal
            document.getElementById('voiceTestModal').classList.add('show');
            document.body.classList.add('modal-open');
            
            // Setup event listeners
            setupVoiceTestControls();
        }

        function hideVoiceTestModal() {
            document.getElementById('voiceTestModal').classList.remove('show');
            document.body.classList.remove('modal-open');
            
            // Stop any active call
            if (vapi && vapi.getCallStatus().isActive) {
                vapi.stop();
            }
            
            resetVoiceTest();
        }

        function loadTestAssistantData(assistantId) {
            // Mock data - in real app this would come from API
            const assistantData = {
                'asst_1': {
                    name: 'Kundenservice Assistent',
                    description: 'Professioneller Support für Kundenfragen mit empathischer Kommunikation'
                },
                'asst_2': {
                    name: 'Termin-Koordinator',
                    description: 'Effiziente Terminbuchung mit automatischer Verfügbarkeitsprüfung'
                },
                'asst_3': {
                    name: 'Informations-Experte',
                    description: 'Umfangreiches Produktwissen für detaillierte Beratung'
                }
            };

            const assistant = assistantData[assistantId] || { name: 'Test Assistant', description: 'Test Beschreibung' };
            
            document.getElementById('testAssistantName').textContent = assistant.name;
            document.getElementById('testAssistantDescription').textContent = assistant.description;
        }

        function setupVoiceTestControls() {
            const startBtn = document.getElementById('startCallBtn');
            const endBtn = document.getElementById('endCallBtn');
            const muteBtn = document.getElementById('muteBtn');

            startBtn.onclick = async () => {
                // Determine which engine to use
                const activeEngine = useRealEngine ? realVapi : vapi;
                const engineName = useRealEngine ? 'Real Engine' : 'Simulator';

                if (!activeEngine) {
                    alert(`${engineName} nicht verfügbar`);
                    return;
                }

                try {
                    console.log(`🚀 Starting call with ${engineName}`);
                    updateCallStatus(`Verbinde mit ${engineName}...`, true);
                    startBtn.style.display = 'none';
                    endBtn.style.display = 'inline-block';
                    muteBtn.style.display = 'inline-block';

                    // Clear previous metrics
                    hidePerformanceMetrics();

                    const assistantConfig = {
                        assistantId: currentTestAssistant,
                        assistant: {
                            name: document.getElementById('testAssistantName').textContent,
                            description: document.getElementById('testAssistantDescription').textContent,
                            firstMessage: 'Hallo! Ich bin Ihr Voice Assistant. Wie kann ich Ihnen helfen?',
                            systemPrompt: 'Du bist ein freundlicher und professioneller AI-Assistent für Kundensupport.',
                            voice: {
                                provider: useRealEngine ? 'elevenlabs' : 'openai',
                                voiceId: useRealEngine ? 'rachel' : 'nova',
                                language: 'de-DE',
                                speed: 1.0
                            },
                            model: {
                                provider: 'openai',
                                model: 'gpt-4o',
                                temperature: 0.7
                            }
                        }
                    };

                    await activeEngine.start(assistantConfig);
                } catch (error) {
                    console.error('Call start error:', error);
                    alert(`Fehler beim Starten des ${engineName}: ${error.message}`);
                    resetVoiceControls();
                }
            };

            endBtn.onclick = async () => {
                const activeEngine = useRealEngine ? realVapi : vapi;
                if (activeEngine) {
                    await activeEngine.stop();
                }
                resetVoiceControls();
            };

            muteBtn.onclick = () => {
                const activeEngine = useRealEngine ? realVapi : vapi;
                if (activeEngine && typeof activeEngine.setMuted === 'function') {
                    const currentStatus = activeEngine.getCallStatus();
                    const isMuted = currentStatus.isMuted || false;
                    activeEngine.setMuted(!isMuted);
                    updateMuteButton(!isMuted);
                }
            };
        }

        function addEngineToggle() {
            // Setup engine selection radio buttons
            const engineRadios = document.querySelectorAll('input[name="voiceEngine"]');
            const engineInfo = document.getElementById('engineInfo');

            engineRadios.forEach(radio => {
                radio.addEventListener('change', (e) => {
                    useRealEngine = e.target.value === 'real';
                    
                    if (useRealEngine) {
                        engineInfo.innerHTML = '<small>⚡ Real Engine: Uses actual APIs (Deepgram, OpenAI, ElevenLabs)</small>';
                        engineInfo.style.background = 'rgba(16, 185, 129, 0.1)';
                        engineInfo.style.color = '#059669';
                    } else {
                        engineInfo.innerHTML = '<small>🎭 Simulator Mode: Safe testing without API costs</small>';
                        engineInfo.style.background = 'rgba(59, 130, 246, 0.1)';
                        engineInfo.style.color = '#2563eb';
                    }
                    
                    console.log(`🔄 Engine switched to: ${useRealEngine ? 'Real' : 'Simulator'}`);
                });
            });
        }

        function showPerformanceMetrics(metrics) {
            console.log('📊 Showing performance metrics:', metrics);
            
            const metricsContainer = document.getElementById('performanceMetrics');
            const sttLatency = document.getElementById('sttLatency');
            const llmLatency = document.getElementById('llmLatency');
            const ttsLatency = document.getElementById('ttsLatency');
            const totalLatency = document.getElementById('totalLatency');

            // Update metric values
            sttLatency.textContent = `${Math.round(metrics.averageSTTLatency || 0)}ms`;
            llmLatency.textContent = `${Math.round(metrics.averageLLMLatency || 0)}ms`;
            ttsLatency.textContent = `${Math.round(metrics.averageTTSLatency || 0)}ms`;
            totalLatency.textContent = `${Math.round(metrics.totalLatency || 0)}ms`;

            // Color-code latencies based on performance
            [sttLatency, llmLatency, ttsLatency, totalLatency].forEach(element => {
                const value = parseInt(element.textContent);
                element.className = 'metric-value';
                
                if (value > 1000) {
                    element.classList.add('critical-latency');
                } else if (value > 500) {
                    element.classList.add('high-latency');
                }
            });

            // Show metrics container
            metricsContainer.style.display = 'block';
        }

        function hidePerformanceMetrics() {
            document.getElementById('performanceMetrics').style.display = 'none';
        }

        function updateCallStatus(status, isActive) {
            const statusEl = document.getElementById('callStatus');
            const statusText = document.getElementById('statusText');
            
            statusEl.style.display = 'block';
            statusText.textContent = status;
            
            const dot = document.querySelector('.status-dot');
            if (isActive) {
                dot.style.background = 'var(--success-color)';
                dot.style.animation = 'pulse 1.5s ease-in-out infinite alternate';
            } else {
                dot.style.background = 'var(--secondary-color)';
                dot.style.animation = 'none';
            }
        }

        function showTranscript() {
            document.getElementById('transcriptContainer').style.display = 'block';
        }

        function addTranscriptEntry(text, user) {
            const transcript = document.getElementById('transcript');
            const entry = document.createElement('div');
            entry.className = `transcript-entry transcript-${user}`;
            
            const time = new Date().toLocaleTimeString();
            const speaker = user === 'assistant' ? '🤖 Assistant' : '👤 Sie';
            
            entry.innerHTML = `<strong>${speaker}</strong> [${time}]<br>${text}`;
            transcript.appendChild(entry);
            
            // Auto-scroll to bottom
            transcript.scrollTop = transcript.scrollHeight;
        }

        function updateMuteButton(isMuted) {
            const muteBtn = document.getElementById('muteBtn');
            const icon = muteBtn.querySelector('i');
            
            if (isMuted) {
                icon.className = 'fas fa-microphone-slash';
                muteBtn.innerHTML = '<i class="fas fa-microphone-slash"></i> Mikrofon an';
                muteBtn.style.background = 'var(--danger-color)';
            } else {
                icon.className = 'fas fa-microphone';
                muteBtn.innerHTML = '<i class="fas fa-microphone"></i> Stumm';
                muteBtn.style.background = '';
            }
        }

        function resetVoiceControls() {
            document.getElementById('startCallBtn').style.display = 'inline-block';
            document.getElementById('endCallBtn').style.display = 'none';
            document.getElementById('muteBtn').style.display = 'none';
            updateMuteButton(false);
        }

        function resetVoiceTest() {
            document.getElementById('callStatus').style.display = 'none';
            document.getElementById('transcriptContainer').style.display = 'none';
            document.getElementById('transcript').innerHTML = '';
            resetVoiceControls();
        }
    </script>
</body>
</html>